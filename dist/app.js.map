{
  "version": 3,
  "sources": ["../src/types.ts", "../src/JsonEditor.ts", "../src/WysiwygEditor.ts", "../src/BlockManager.ts", "../src/ConnectionManager.ts", "../src/toolbar/SaveLoadManager.ts", "../src/toolbar/ThemeMenu.ts", "../src/toolbar/ArrangeMenu.ts", "../src/toolbar/ConnectionStyleMenu.ts", "../src/Toolbar.ts", "../src/AutoCreatePopup.ts", "../src/config.ts", "../src/reducer.ts", "../src/Store.ts", "../src/EventBus.ts", "../src/ViewportController.ts", "../src/ConnectionDraftController.ts", "../src/UndoManager.ts", "../src/layout.ts", "../src/GridManager.ts", "../src/ThemeManager.ts", "../src/FileIO.ts", "../src/HotkeysManager.ts", "../src/UndoDebugPanel.ts", "../src/MinimapManager.ts", "../src/core/FlowchartApp.ts", "../src/app.ts"],
  "sourcesContent": ["// Core Types & State Management\r\n\r\nexport interface Point { x: number; y: number; }\r\nexport interface Size { width: number; height: number; }\r\n\r\nexport type BlockId = string;\r\nexport type ConnectionId = string;\r\n\r\nexport type BlockKind = 'start' | 'process' | 'decision' | 'io' | 'end';\r\n\r\nexport interface Block {\r\n\tid: BlockId;\r\n\tkind: BlockKind;\r\n\tposition: Point;\r\n\tsize: Size;\r\n\ttitle: string;\r\n\tdescriptionHtml: string; // editable HTML region\r\n\tproperties: Record<string, any>; // JSON object\r\n}\r\n\r\nexport type ConnectionStyle = 'bezier' | 'orthogonal';\r\n\r\nexport interface Connection {\r\n\tid: ConnectionId;\r\n\tsource: BlockId;\r\n\ttarget: BlockId;\r\n\tstyle: ConnectionStyle;\r\n\tlabel?: string; // editable label text stored separately from id\r\n}\r\n\r\nexport interface ViewportState {\r\n\tscale: number; // zoom factor\r\n\toffset: Point; // panning offset\r\n\tbounds: { minScale: number; maxScale: number };\r\n}\r\n\r\nexport interface AppState {\r\n\tblocks: Record<BlockId, Block>;\r\n\tconnections: Record<ConnectionId, Connection>;\r\n\tselection: { blockId?: BlockId; connectionId?: ConnectionId };\r\n\tmultiSelect?: BlockId[]; // multiple selected block ids (includes primary if present)\r\n\tviewport: ViewportState;\r\n\tconnectionDraft?: { sourceBlock: BlockId; currentPoint: Point };\r\n\tconnectionStyle: ConnectionStyle;\r\n\tgrid?: { enabled: boolean; size: number; snap: boolean };\r\n\thistoryVersion: number; // increments each mutating action for potential undo batching\r\n}\r\n\r\nexport const initialState = (): AppState => ({\r\n\tblocks: {},\r\n\tconnections: {},\r\n\tselection: {},\r\n\tmultiSelect: [],\r\n\tviewport: { scale: 1, offset: { x: 0, y: 0 }, bounds: { minScale: 0.25, maxScale: 3 } },\r\n\tconnectionStyle: 'bezier',\r\n\tgrid: { enabled: true, size: 20, snap: true },\r\n\thistoryVersion: 0\r\n});\r\n\r\n// Actions\r\nexport type Action =\r\n\t| { type: 'ADD_BLOCK'; block: Block }\r\n\t| { type: 'UPDATE_BLOCK'; id: BlockId; patch: Partial<Omit<Block, 'id'>> }\r\n\t| { type: 'MOVE_BLOCK'; id: BlockId; position: Point }\r\n\t| { type: 'DELETE_BLOCK'; id: BlockId }\r\n\t| { type: 'ADD_CONNECTION'; connection: Connection }\r\n\t| { type: 'UPDATE_CONNECTION'; id: ConnectionId; patch: Partial<Omit<Connection, 'id'>> }\r\n\t| { type: 'DELETE_CONNECTION'; id: ConnectionId }\r\n\t| { type: 'SET_CONNECTION_STYLE'; style: ConnectionStyle }\r\n\t| { type: 'START_CONNECTION_DRAFT'; sourceBlock: BlockId; point: Point }\r\n\t| { type: 'UPDATE_CONNECTION_DRAFT'; point: Point }\r\n\t| { type: 'CANCEL_CONNECTION_DRAFT' }\r\n\t| { type: 'SELECT_BLOCK'; id?: BlockId }\r\n\t| { type: 'SELECT_CONNECTION'; id?: ConnectionId }\r\n\t| { type: 'SET_MULTI_SELECT'; ids: BlockId[] }\r\n\t| { type: 'SET_VIEWPORT'; viewport: Partial<ViewportState> }\r\n\t| { type: 'SET_GRID'; grid: Partial<{ enabled: boolean; size: number; snap: boolean }> }\r\n\t| { type: 'INCREMENT_HISTORY' }\r\n\t| { type: 'BULK_SET_STATE'; state: Partial<AppState> }\r\n\t| { type: 'MULTIDRAG_BLOCKS'; changes: { id: BlockId; position: Point }[] };\r\n\r\n\r\n// Simple EventBus\r\nexport type EventHandler = (payload?: any) => void;\r\nexport class EventBus {\r\n\tprivate listeners = new Map<string, Set<EventHandler>>();\r\n\ton(evt: string, handler: EventHandler) { if (!this.listeners.has(evt)) this.listeners.set(evt, new Set()); this.listeners.get(evt)!.add(handler); }\r\n\toff(evt: string, handler: EventHandler) { this.listeners.get(evt)?.delete(handler); }\r\n\temit(evt: string, payload?: any) { this.listeners.get(evt)?.forEach(h => h(payload)); }\r\n\tclear() { this.listeners.clear(); }\r\n}\r\n\r\n// Utilities\r\nexport const uid = (p = 'id'): string => `${p}_${Math.random().toString(36).slice(2, 10)}`;\r\nexport function clamp(v: number, min: number, max: number) { return Math.min(max, Math.max(min, v)); }\r\nexport function lerp(a: number, b: number, t: number) { return a + (b - a) * t; }\r\n\r\n", "export interface JsonEditorOptions {\r\n  value: any;\r\n  onChange(value: any): void;\r\n  onValidity?(valid: boolean): void;\r\n  height?: number;\r\n}\r\n\r\n// Lightweight JSON editor with inline validation + basic syntax highlighting.\r\n// Uses a textarea for input and a mirrored pre element for colored tokens.\r\nexport class JsonEditor {\r\n  root: HTMLElement;\r\n  private textarea: HTMLTextAreaElement;\r\n  private highlightPane: HTMLElement;\r\n  private lastValid = true;\r\n  private opts: JsonEditorOptions;\r\n  private toolbar: HTMLElement;\r\n  private highlightEnabled = true;\r\n  private formatBtn: HTMLButtonElement;\r\n  private highlightBtn: HTMLButtonElement;\r\n  private statusEl: HTMLElement;\r\n\r\n  constructor(opts: JsonEditorOptions) {\r\n    this.opts = opts;\r\n    this.root = document.createElement('div');\r\n    this.root.className = 'fc-json-editor';\r\n    this.root.innerHTML = `\r\n      <div class=\"fc-json-editor-toolbar\">\r\n        <button type=\"button\" class=\"fc-json-ed-btn fmt\" title=\"Format JSON\">Format</button>\r\n        <button type=\"button\" class=\"fc-json-ed-btn toggle-hl\" title=\"Toggle Syntax Highlight\">HL On</button>\r\n        <div class=\"fc-json-ed-spacer\"></div>\r\n        <small class=\"fc-json-ed-hint\">Esc to close popup</small>\r\n      </div>\r\n      <div class=\"fc-json-editor-stack\">\r\n        <textarea class=\"fc-json-editor-input\" spellcheck=\"false\"></textarea>\r\n        <pre class=\"fc-json-editor-highlight\" aria-hidden=\"true\"></pre>\r\n      </div>\r\n      <div class=\"fc-json-editor-status\" role=\"status\" aria-live=\"polite\"></div>\r\n    `;\r\n    this.textarea = this.root.querySelector('.fc-json-editor-input') as HTMLTextAreaElement;\r\n    this.highlightPane = this.root.querySelector('.fc-json-editor-highlight') as HTMLElement;\r\n    this.toolbar = this.root.querySelector('.fc-json-editor-toolbar') as HTMLElement;\r\n    this.statusEl = this.root.querySelector('.fc-json-editor-status') as HTMLElement;\r\n    this.formatBtn = this.toolbar.querySelector('.fmt') as HTMLButtonElement;\r\n    this.highlightBtn = this.toolbar.querySelector('.toggle-hl') as HTMLButtonElement;\r\n    this.textarea.value = JSON.stringify(opts.value ?? {}, null, 2);\r\n    this.textarea.addEventListener('input', () => this.handleInput());\r\n    this.textarea.addEventListener('scroll', () => this.syncScroll());\r\n    this.formatBtn.addEventListener('click', () => this.format());\r\n    this.highlightBtn.addEventListener('click', () => this.toggleHighlight());\r\n    this.handleInput();\r\n    if (opts.height) {\r\n      (this.root.querySelector('.fc-json-editor-stack') as HTMLElement).style.height = opts.height + 'px';\r\n    }\r\n    // Auto-disable highlighting for very large JSON to avoid perf issues\r\n    if (this.textarea.value.length > 20000) {\r\n      this.highlightEnabled = false;\r\n      this.applyHighlightMode();\r\n    } else {\r\n      this.root.classList.add('with-highlight');\r\n    }\r\n  }\r\n\r\n  focus() { this.textarea.focus(); }\r\n  getValueRaw() { return this.textarea.value; }\r\n\r\n  private syncScroll() { this.highlightPane.scrollTop = this.textarea.scrollTop; this.highlightPane.scrollLeft = this.textarea.scrollLeft; }\r\n\r\n  private setStatus(msg: string, ok: boolean) {\r\n    const status = this.root.querySelector('.fc-json-editor-status') as HTMLElement;\r\n    status.textContent = msg;\r\n    status.style.color = ok ? 'var(--fc-json-status-ok, var(--accent-color, #2d8f2d))' : 'var(--fc-json-status-err, #d33)';\r\n  }\r\n\r\n  private handleInput() {\r\n    const txt = this.textarea.value;\r\n    let valid = true; let parsed: any = null;\r\n    let errorPos: number | null = null; let errorMsg: string | null = null;\r\n    try { parsed = JSON.parse(txt || 'null'); } catch (err: any) {\r\n      valid = false;\r\n      const msg = String(err?.message || 'Invalid JSON');\r\n      const m = msg.match(/position (\\d+)/i);\r\n      if (m) errorPos = parseInt(m[1],10);\r\n      errorMsg = msg;\r\n    }\r\n    if (valid) {\r\n      this.setStatus('Valid JSON', true);\r\n      // Only emit onChange if JSON parses to something different (shallow ref change ok)\r\n      this.opts.onChange(parsed);\r\n    } else {\r\n      if (errorPos != null) {\r\n        const lc = this.indexToLineCol(txt, errorPos);\r\n        this.setStatus(`Error Ln ${lc.line}, Col ${lc.col} (pos ${errorPos})`, false);\r\n      } else if (errorMsg) {\r\n        this.setStatus(errorMsg, false);\r\n      } else {\r\n        this.setStatus('Invalid JSON', false);\r\n      }\r\n    }\r\n    if (valid !== this.lastValid) { this.opts.onValidity?.(valid); this.lastValid = valid; }\r\n    this.refreshHighlight(txt);\r\n    this.formatBtn.disabled = !valid;\r\n  }\r\n\r\n  private refreshHighlight(txt: string) {\r\n    if (!this.highlightEnabled) {\r\n      this.highlightPane.textContent = '';\r\n      return;\r\n    }\r\n    if (txt.length < 20000) this.highlightPane.innerHTML = this.highlightJson(txt); else this.highlightPane.textContent = txt;\r\n  }\r\n\r\n  private indexToLineCol(text: string, index: number) {\r\n    let line = 1, col = 1;\r\n    for (let i=0; i<index && i<text.length; i++) {\r\n      if (text[i] === '\\n') { line++; col = 1; } else { col++; }\r\n    }\r\n    return { line, col };\r\n  }\r\n\r\n  private escapeHtml(s: string) { return s.replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\\'':'&#39;'} as any)[c]); }\r\n\r\n  private highlightJson(source: string): string {\r\n    // Simple tokenizer: strings, numbers, booleans, null, punctuation\r\n    const esc = this.escapeHtml(source);\r\n    return esc\r\n      .replace(/(&quot;.*?&quot;)(\\s*:)?/g, (m, g1, g2) => `<span class=\"j-str\">${g1}</span>${g2?'<span class=\"j-punc\">'+g2+'</span>': ''}`)\r\n      .replace(/\\b(true|false)\\b/g, '<span class=\"j-bool\">$1</span>')\r\n      .replace(/\\b(null)\\b/g, '<span class=\"j-null\">$1</span>')\r\n      .replace(/\\b(-?\\d+(?:\\.\\d+)?(?:[eE][+-]?\\d+)?)\\b/g, '<span class=\"j-num\">$1</span>')\r\n      .replace(/([{}\\[\\],])/g, '<span class=\"j-punc\">$1</span>');\r\n  }\r\n\r\n  private format() {\r\n    try {\r\n      const parsed = JSON.parse(this.textarea.value || 'null');\r\n      const formatted = JSON.stringify(parsed, null, 2);\r\n      this.textarea.value = formatted;\r\n      this.handleInput();\r\n    } catch { /* ignore format when invalid */ }\r\n  }\r\n\r\n  private toggleHighlight() {\r\n    this.highlightEnabled = !this.highlightEnabled;\r\n    this.applyHighlightMode();\r\n  }\r\n\r\n  private applyHighlightMode() {\r\n    if (this.highlightEnabled) {\r\n      this.root.classList.add('with-highlight');\r\n      this.highlightBtn.textContent = 'HL On';\r\n      this.refreshHighlight(this.textarea.value);\r\n      this.textarea.classList.add('hl-active');\r\n    } else {\r\n      this.root.classList.remove('with-highlight');\r\n      this.highlightBtn.textContent = 'HL Off';\r\n      this.textarea.classList.remove('hl-active');\r\n    }\r\n  }\r\n}\r\n", "// Simple media popup for inserting YouTube/video by URL\r\nclass WysiwygMediaPopup {\r\n  el: HTMLElement;\r\n  private onSubmit: (url: string) => void;\r\n  private onCancel: () => void;\r\n  constructor(onSubmit: (url: string) => void, onCancel: () => void, initialUrl?: string) {\r\n    this.el = document.createElement('div');\r\n    this.el.className = 'fc-wys-media-popup fc-theme';\r\n    this.el.innerHTML = `\r\n      <label>Media URL: <input type=\"url\" class=\"fc-wys-media-url\" value=\"${initialUrl||''}\" placeholder=\"YouTube or video URL\" /></label>\r\n      <div class=\"fc-wys-popup-actions\">\r\n        <button type=\"button\" class=\"fc-wys-btn fc-wys-media-ok primary\">OK</button>\r\n        <button type=\"button\" class=\"fc-wys-btn fc-wys-media-cancel\">Cancel</button>\r\n      </div>\r\n    `;\r\n    this.onSubmit = onSubmit;\r\n    this.onCancel = onCancel;\r\n    (this.el.querySelector('.fc-wys-media-ok') as HTMLButtonElement).onclick = () => {\r\n      const url = (this.el.querySelector('.fc-wys-media-url') as HTMLInputElement).value.trim();\r\n      if (url) this.onSubmit(url);\r\n    };\r\n    (this.el.querySelector('.fc-wys-media-cancel') as HTMLButtonElement).onclick = () => this.onCancel();\r\n  }\r\n}\r\n// Simple image popup for inserting image by URL\r\nclass WysiwygImagePopup {\r\n  el: HTMLElement;\r\n  private onSubmit: (url: string, alt?: string) => void;\r\n  private onCancel: () => void;\r\n  constructor(onSubmit: (url: string, alt?: string) => void, onCancel: () => void, initialUrl?: string, initialAlt?: string) {\r\n    this.el = document.createElement('div');\r\n    this.el.className = 'fc-wys-image-popup fc-theme';\r\n    this.el.innerHTML = `\r\n      <label>Image URL: <input type=\"url\" class=\"fc-wys-img-url\" value=\"${initialUrl||''}\" placeholder=\"https://...\" /></label>\r\n      <label>Alt Text: <input type=\"text\" class=\"fc-wys-img-alt\" value=\"${initialAlt||''}\" placeholder=\"Description\" /></label>\r\n      <div class=\"fc-wys-popup-actions\">\r\n        <button type=\"button\" class=\"fc-wys-btn fc-wys-img-ok primary\">OK</button>\r\n        <button type=\"button\" class=\"fc-wys-btn fc-wys-img-cancel\">Cancel</button>\r\n      </div>\r\n    `;\r\n    this.onSubmit = onSubmit;\r\n    this.onCancel = onCancel;\r\n    (this.el.querySelector('.fc-wys-img-ok') as HTMLButtonElement).onclick = () => {\r\n      const url = (this.el.querySelector('.fc-wys-img-url') as HTMLInputElement).value.trim();\r\n      const alt = (this.el.querySelector('.fc-wys-img-alt') as HTMLInputElement).value.trim();\r\n      if (url) this.onSubmit(url, alt);\r\n    };\r\n    (this.el.querySelector('.fc-wys-img-cancel') as HTMLButtonElement).onclick = () => this.onCancel();\r\n  }\r\n}\r\n// Simple link popup for inserting/editing links\r\nclass WysiwygLinkPopup {\r\n  el: HTMLElement;\r\n  private onSubmit: (url: string, text?: string) => void;\r\n  private onCancel: () => void;\r\n  constructor(onSubmit: (url: string, text?: string) => void, onCancel: () => void, initialUrl?: string, initialText?: string) {\r\n    this.el = document.createElement('div');\r\n    this.el.className = 'fc-wys-link-popup fc-theme';\r\n    this.el.innerHTML = `\r\n      <label>URL: <input type=\"url\" class=\"fc-wys-link-url\" value=\"${initialUrl||''}\" placeholder=\"https://...\" /></label>\r\n      <label>Text: <input type=\"text\" class=\"fc-wys-link-text\" value=\"${initialText||''}\" placeholder=\"Link text\" /></label>\r\n      <div class=\"fc-wys-popup-actions\">\r\n        <button type=\"button\" class=\"fc-wys-btn fc-wys-link-ok primary\">OK</button>\r\n        <button type=\"button\" class=\"fc-wys-btn fc-wys-link-cancel\">Cancel</button>\r\n      </div>\r\n    `;\r\n    this.onSubmit = onSubmit;\r\n    this.onCancel = onCancel;\r\n    (this.el.querySelector('.fc-wys-link-ok') as HTMLButtonElement).onclick = () => {\r\n      const url = (this.el.querySelector('.fc-wys-link-url') as HTMLInputElement).value.trim();\r\n      const text = (this.el.querySelector('.fc-wys-link-text') as HTMLInputElement).value.trim();\r\n      if (url) this.onSubmit(url, text);\r\n    };\r\n    (this.el.querySelector('.fc-wys-link-cancel') as HTMLButtonElement).onclick = () => this.onCancel();\r\n  }\r\n}\r\nexport interface WysiwygEditorOptions {\r\n  value: string;\r\n  onSave(html: string): void;\r\n  onCancel(): void;\r\n}\r\n\r\n// Very lightweight WYSIWYG editor: bold, italic, underline, unordered list.\r\n// Uses contenteditable DIV and (deprecated) execCommand for simplicity.\r\n\r\n// Modular toolbar component\r\nclass WysiwygToolbar {\r\n  el: HTMLElement;\r\n  constructor(onCmd: (cmd: string) => void, onSave: () => void, onCancel: () => void) {\r\n    this.el = document.createElement('div');\r\n    this.el.className = 'fc-wys-toolbar fc-theme';\r\n    this.el.innerHTML = `\r\n      <button type=\"button\" data-cmd=\"bold\" title=\"Bold\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><text x=\"3\" y=\"14\" font-weight=\"bold\" font-size=\"14\">B</text></svg></span></button>\r\n      <button type=\"button\" data-cmd=\"italic\" title=\"Italic\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><text x=\"5\" y=\"14\" font-style=\"italic\" font-size=\"14\">I</text></svg></span></button>\r\n      <button type=\"button\" data-cmd=\"underline\" title=\"Underline\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><text x=\"3\" y=\"14\" font-size=\"14\">U</text><line x1=\"3\" y1=\"16\" x2=\"15\" y2=\"16\" stroke=\"currentColor\" stroke-width=\"2\"/></svg></span></button>\r\n      <button type=\"button\" data-cmd=\"insertUnorderedList\" title=\"Bullet List\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><circle cx=\"5\" cy=\"9\" r=\"2\"/><rect x=\"9\" y=\"8\" width=\"6\" height=\"2\" rx=\"1\"/></svg></span></button>\r\n      <button type=\"button\" data-cmd=\"link\" title=\"Link\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><path d=\"M6 9a3 3 0 0 1 3-3h2a3 3 0 1 1 0 6h-2a3 3 0 1 1-3-3z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/></svg></span></button>\r\n      <button type=\"button\" data-cmd=\"image\" title=\"Image\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><rect x=\"2\" y=\"4\" width=\"14\" height=\"10\" rx=\"2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/><circle cx=\"6\" cy=\"8\" r=\"2\"/><path d=\"M2 14l4-4 3 3 5-5\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"/></svg></span></button>\r\n      <button type=\"button\" data-cmd=\"media\" title=\"Media\" class=\"fc-wys-btn\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><rect x=\"3\" y=\"5\" width=\"12\" height=\"8\" rx=\"2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/><polygon points=\"8,8 12,9 8,10\" fill=\"currentColor\"/></svg></span></button>\r\n      <span class=\"fc-wys-spacer\"></span>\r\n      <button type=\"button\" class=\"fc-wys-btn fc-wys-save\" title=\"Save\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><rect x=\"3\" y=\"3\" width=\"12\" height=\"12\" rx=\"2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/><polyline points=\"5,9 8,12 13,7\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/></svg></span>Save</button>\r\n      <button type=\"button\" class=\"fc-wys-btn fc-wys-cancel\" title=\"Cancel\"><span class=\"fc-wys-icn\"><svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><rect x=\"3\" y=\"3\" width=\"12\" height=\"12\" rx=\"2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"/><line x1=\"6\" y1=\"6\" x2=\"12\" y2=\"12\" stroke=\"currentColor\" stroke-width=\"2\"/><line x1=\"12\" y1=\"6\" x2=\"6\" y2=\"12\" stroke=\"currentColor\" stroke-width=\"2\"/></svg></span>Cancel</button>\r\n    `;\r\n    this.el.querySelectorAll('[data-cmd]').forEach(btn => {\r\n      btn.addEventListener('click', () => {\r\n        const cmd = (btn as HTMLElement).dataset.cmd!;\r\n        onCmd(cmd);\r\n      });\r\n    });\r\n    (this.el.querySelector('.fc-wys-save') as HTMLButtonElement).addEventListener('click', onSave);\r\n    (this.el.querySelector('.fc-wys-cancel') as HTMLButtonElement).addEventListener('click', onCancel);\r\n  }\r\n}\r\n\r\nexport class WysiwygEditor {\r\n  root: HTMLElement;\r\n  private area: HTMLDivElement;\r\n  private opts: WysiwygEditorOptions;\r\n  private toolbar: WysiwygToolbar;\r\n    private popupContainer: HTMLElement;\r\n    private activePopup: HTMLElement|null = null;\r\n    private static IMAGE_BLOCK_CLASS = 'fc-wys-img-block';\r\n    private static MEDIA_BLOCK_CLASS = 'fc-wys-media-block';\r\n    private savedRange: Range | null = null;\r\n  constructor(opts: WysiwygEditorOptions) {\r\n    this.opts = opts;\r\n    this.root = document.createElement('div');\r\n    this.root.className = 'fc-wys-editor fc-theme';\r\n    this.toolbar = new WysiwygToolbar(\r\n      (cmd) => this.handleCmd(cmd),\r\n      () => this.opts.onSave(this.cleanHtml(this.area.innerHTML)),\r\n      () => this.opts.onCancel()\r\n    );\r\n    this.root.appendChild(this.toolbar.el);\r\n    this.area = document.createElement('div');\r\n    this.area.className = 'fc-wys-area';\r\n    this.area.setAttribute('contenteditable', 'true');\r\n    this.area.innerHTML = opts.value || '<p></p>';\r\n    this.root.appendChild(this.area);\r\n      this.popupContainer = document.createElement('div');\r\n      this.popupContainer.className = 'fc-wys-popup-container';\r\n      this.root.appendChild(this.popupContainer);\r\n    this.attach();\r\n  }\r\n\r\n  focus() { this.area.focus(); }\r\n\r\n  private handleCmd(cmd: string) {\r\n    if (cmd === 'link') {\r\n      this.captureSelection();\r\n      this.openLinkPopup();\r\n    } else if (cmd === 'image') {\r\n      this.captureSelection();\r\n      this.openImagePopup();\r\n    } else if (cmd === 'media') {\r\n      this.captureSelection();\r\n      this.openMediaPopup();\r\n    } else {\r\n      this.exec(cmd);\r\n    }\r\n    this.area.focus();\r\n  }\r\n  private openMediaPopup() {\r\n    if (this.activePopup) return;\r\n    const popup = new WysiwygMediaPopup(\r\n      (url) => {\r\n        this.restoreSelection();\r\n        this.insertMediaBlock(url);\r\n        this.closePopup();\r\n      },\r\n      () => this.closePopup()\r\n    );\r\n    this.activePopup = popup.el;\r\n    this.popupContainer.appendChild(popup.el);\r\n    (popup.el.querySelector('.fc-wys-media-url') as HTMLInputElement).focus();\r\n  }\r\n\r\n  private insertMediaBlock(url: string) {\r\n    const sel = window.getSelection();\r\n    let range: Range | null = null;\r\n    if (sel && sel.rangeCount > 0) range = sel.getRangeAt(0);\r\n    if (!range) {\r\n      // fallback: append at end\r\n      range = document.createRange();\r\n      const end = this.area.lastChild || this.area;\r\n      range.selectNodeContents(end instanceof Text ? this.area : end);\r\n      range.collapse(false);\r\n    }\r\n    range.deleteContents();\r\n    const block = document.createElement('div');\r\n    block.className = WysiwygEditor.MEDIA_BLOCK_CLASS;\r\n    block.contentEditable = 'false';\r\n    block.style.width = '100%';\r\n    block.style.margin = '16px 0';\r\n    let embedHtml = '';\r\n    // YouTube\r\n    const ytMatch = url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([\\w-]{11})/);\r\n    if (ytMatch) {\r\n      const vid = ytMatch[1];\r\n      embedHtml = `<iframe width=\"100%\" height=\"360\" src=\"https://www.youtube.com/embed/${vid}\" frameborder=\"0\" allowfullscreen></iframe>`;\r\n    } else if (/\\.(mp4|webm|ogg)$/i.test(url)) {\r\n      embedHtml = `<video src=\"${url}\" controls style=\"width:100%;height:auto;\"></video>`;\r\n    } else {\r\n      embedHtml = `<a href=\"${url}\" target=\"_blank\">${url}</a>`;\r\n    }\r\n    block.innerHTML = embedHtml;\r\n    range.insertNode(block);\r\n    // Move cursor after block\r\n    range.setStartAfter(block);\r\n    range.collapse(true);\r\n    if (sel) {\r\n      sel.removeAllRanges();\r\n      sel.addRange(range);\r\n    }\r\n    this.area.focus();\r\n  }\r\n  private openImagePopup() {\r\n    if (this.activePopup) return;\r\n    const popup = new WysiwygImagePopup(\r\n      (url, alt) => {\r\n        this.restoreSelection();\r\n        this.insertImageBlock(url, alt);\r\n        this.closePopup();\r\n      },\r\n      () => this.closePopup()\r\n    );\r\n    this.activePopup = popup.el;\r\n    this.popupContainer.appendChild(popup.el);\r\n    (popup.el.querySelector('.fc-wys-img-url') as HTMLInputElement).focus();\r\n  }\r\n\r\n  private insertImageBlock(url: string, alt?: string) {\r\n    const sel = window.getSelection();\r\n    let range: Range | null = null;\r\n    if (sel && sel.rangeCount > 0) range = sel.getRangeAt(0);\r\n    if (!range) {\r\n      range = document.createRange();\r\n      const end = this.area.lastChild || this.area;\r\n      range.selectNodeContents(end instanceof Text ? this.area : end);\r\n      range.collapse(false);\r\n    }\r\n    range.deleteContents();\r\n    // Remove any adjacent nodes before/after\r\n    const block = document.createElement('div');\r\n    block.className = WysiwygEditor.IMAGE_BLOCK_CLASS;\r\n    block.contentEditable = 'false';\r\n    block.style.width = '100%';\r\n    block.style.margin = '16px 0';\r\n    block.innerHTML = `<img src=\"${url}\" alt=\"${alt||''}\" style=\"width:100%;height:auto;display:block;\" />`;\r\n    range.insertNode(block);\r\n    // Move cursor after block\r\n    range.setStartAfter(block);\r\n    range.collapse(true);\r\n    if (sel) {\r\n      sel.removeAllRanges();\r\n      sel.addRange(range);\r\n    }\r\n    this.area.focus();\r\n  }\r\n  private openLinkPopup() {\r\n    if (this.activePopup) return;\r\n    // Try to get selected text and link\r\n    let initialUrl = '';\r\n    let initialText = '';\r\n    const sel = window.getSelection();\r\n    if (sel && sel.rangeCount > 0) {\r\n      const range = sel.getRangeAt(0);\r\n      const container = range.startContainer.parentElement;\r\n      if (container && container.tagName === 'A') {\r\n        initialUrl = (container as HTMLAnchorElement).href;\r\n        initialText = container.textContent || '';\r\n      } else {\r\n        initialText = sel.toString();\r\n      }\r\n    }\r\n    const popup = new WysiwygLinkPopup(\r\n      (url, text) => {\r\n        this.restoreSelection();\r\n        this.insertLink(url, text);\r\n        this.closePopup();\r\n      },\r\n      () => this.closePopup(),\r\n      initialUrl,\r\n      initialText\r\n    );\r\n    this.activePopup = popup.el;\r\n    this.popupContainer.appendChild(popup.el);\r\n    (popup.el.querySelector('.fc-wys-link-url') as HTMLInputElement).focus();\r\n  }\r\n\r\n  private closePopup() {\r\n    if (this.activePopup) {\r\n      this.popupContainer.removeChild(this.activePopup);\r\n      this.activePopup = null;\r\n    }\r\n  }\r\n\r\n  private insertLink(url: string, text?: string) {\r\n    const sel = window.getSelection();\r\n    let range: Range | null = null;\r\n    if (sel && sel.rangeCount > 0) range = sel.getRangeAt(0);\r\n    if (!range) {\r\n      range = document.createRange();\r\n      const end = this.area.lastChild || this.area;\r\n      range.selectNodeContents(end instanceof Text ? this.area : end);\r\n      range.collapse(false);\r\n    }\r\n    range.deleteContents();\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.textContent = text || url;\r\n    a.target = '_blank';\r\n    range.insertNode(a);\r\n    // Move cursor after link\r\n    range.setStartAfter(a);\r\n    range.collapse(true);\r\n    if (sel) {\r\n      sel.removeAllRanges();\r\n      sel.addRange(range);\r\n    }\r\n    this.area.focus();\r\n  }\r\n\r\n  private exec(cmd: string) {\r\n    try { (document as any).execCommand?.(cmd, false); } catch {}\r\n  }\r\n\r\n  private attach() {\r\n    this.area.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape') { e.preventDefault(); this.opts.onCancel(); }\r\n      else if (e.key === 's' && (e.metaKey || e.ctrlKey)) { e.preventDefault(); this.opts.onSave(this.cleanHtml(this.area.innerHTML)); }\r\n    });\r\n    // Paste handler for link, image, and media\r\n    this.area.addEventListener('paste', (e: ClipboardEvent) => {\r\n      const text = e.clipboardData?.getData('text/plain')?.trim();\r\n      const items = e.clipboardData?.items;\r\n      // Image paste (from file or URL)\r\n      if (items) {\r\n        for (let i=0; i<items.length; i++) {\r\n          const item = items[i];\r\n          if (item.type.startsWith('image/')) {\r\n            e.preventDefault();\r\n            const file = item.getAsFile();\r\n            if (file) {\r\n              const reader = new FileReader();\r\n              reader.onload = () => {\r\n                this.insertImageBlock(reader.result as string);\r\n              };\r\n              reader.readAsDataURL(file);\r\n            }\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      // Paste image URL\r\n      if (text && /^https?:\\/\\/.+\\.(png|jpe?g|gif|svg|webp)$/i.test(text)) {\r\n        e.preventDefault();\r\n        this.insertImageBlock(text);\r\n        return;\r\n      }\r\n      // Paste YouTube or video link\r\n      if (text && /^(https?:\\/\\/)?(www\\.)?(youtube\\.com\\/watch\\?v=|youtu\\.be\\/)[\\w-]{11}/.test(text)) {\r\n        e.preventDefault();\r\n        this.insertMediaBlock(text);\r\n        return;\r\n      }\r\n      if (text && /\\.(mp4|webm|ogg)$/i.test(text)) {\r\n        e.preventDefault();\r\n        this.insertMediaBlock(text);\r\n        return;\r\n      }\r\n      // Paste link\r\n      if (text && /^https?:\\/\\//.test(text)) {\r\n        e.preventDefault();\r\n        this.insertLink(text);\r\n      }\r\n    });\r\n  }\r\n\r\n  private captureSelection() {\r\n    const sel = window.getSelection();\r\n    if (sel && sel.rangeCount > 0) {\r\n      const r = sel.getRangeAt(0);\r\n      // Only store if inside editor\r\n      if (this.area.contains(r.startContainer)) {\r\n        this.savedRange = r.cloneRange();\r\n      }\r\n    }\r\n  }\r\n\r\n  private restoreSelection() {\r\n    if (!this.savedRange) return;\r\n    const sel = window.getSelection();\r\n    if (sel) {\r\n      sel.removeAllRanges();\r\n      sel.addRange(this.savedRange);\r\n    }\r\n    this.savedRange = null;\r\n  }\r\n\r\n  private cleanHtml(html: string): string {\r\n    // Basic cleanup: remove leading/trailing whitespace and ensure paragraph wrapper when empty\r\n    const trimmed = html.trim();\r\n    return trimmed || '<p></p>';\r\n  }\r\n}\r\n", "import { Action, Block, BlockId, BlockKind, Point, Size, uid } from './types.js';\r\nimport { JsonEditor } from './JsonEditor.js';\r\nimport { EventBus, EventMap } from './EventBus.js';\r\nimport { WysiwygEditor } from './WysiwygEditor.js';\r\n\r\ninterface BlockManagerDeps {\r\n\tdispatch(a: Action): void;\r\n\tgetState(): any;\r\n\tbus?: EventBus<EventMap>;\r\n}\r\n\r\nexport class BlockManager {\r\n\tprivate root: HTMLElement;\r\n\tprivate deps: BlockManagerDeps;\r\n\tprivate rafDragging = false;\r\n\tprivate dragRafHandle: number | null = null;\r\n\tprivate dragContext: null | { id: BlockId; offset: Point; initialPositions: Record<string, Point> } = null;\r\n\tprivate resizeObserver: ResizeObserver;\r\n\tprivate observed = new Set<string>();\r\n\r\n\tconstructor(root: HTMLElement, deps: BlockManagerDeps) {\r\n\t\tthis.root = root;\r\n\t\tthis.deps = deps;\r\n\t\tthis.resizeObserver = new ResizeObserver(entries => {\r\n\t\t\tfor (const entry of entries) {\r\n\t\t\t\tconst el = entry.target as HTMLElement;\r\n\t\t\t\tconst id = el.id;\r\n\t\t\t\tif (!id || !this.observed.has(id)) continue;\r\n\t\t\t\tconst state = this.deps.getState();\r\n\t\t\t\tconst blk = state.blocks[id] as Block | undefined;\r\n\t\t\t\tif (!blk) continue;\r\n\t\t\t\tconst newW = Math.round(entry.contentRect.width);\r\n\t\t\t\tconst newH = Math.round(entry.contentRect.height);\r\n\t\t\t\tif (newW !== blk.size.width || newH !== blk.size.height) {\r\n\t\t\t\t\tthis.deps.dispatch({ type: 'UPDATE_BLOCK', id, patch: { size: { width: newW, height: newH } } });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcreateBlock(kind: BlockKind, position: Point) {\r\n\t\tconst block: Block = {\r\n\t\t\tid: uid('blk'),\r\n\t\t\tkind,\r\n\t\t\tposition,\r\n\t\t\tsize: { width: 170, height: 100 },\r\n\t\t\ttitle: kind.charAt(0).toUpperCase() + kind.slice(1),\r\n\t\t\tdescriptionHtml: '<p>Description...</p>',\r\n\t\t\tproperties: {}\r\n\t\t};\r\n\t\tthis.deps.dispatch({ type: 'ADD_BLOCK', block });\r\n\t\tthis.renderBlock(block);\r\n\t\t// Fallback: if caller did not wrap in undo run, attempt to commit operation (legacy safety)\r\n\t\tqueueMicrotask(()=> (this.deps as any).undoCommit?.());\r\n\t}\r\n\r\n\trenderAll() {\r\n\t\t// Clear existing\r\n\t\tthis.root.querySelectorAll('.fc-block').forEach(el => el.remove());\r\n\t\tconst { blocks } = this.deps.getState();\r\n\t\t(Object.values(blocks) as Block[]).forEach(b => this.renderBlock(b));\r\n\t}\r\n\r\n\tprivate renderBlock(block: Block) {\r\n\t\tlet el = document.getElementById(block.id) as HTMLElement | null;\r\n\t\tif (!el) {\r\n\t\t\tel = document.createElement('div');\r\n\t\t\tel.id = block.id;\r\n\t\t\tel.className = 'fc-block';\r\n\t\t\tel.dataset.type = block.kind;\r\n\t\t\tel.innerHTML = `\r\n\t\t\t\t<div class=\"fc-block-header\">\r\n\t\t\t\t\t<div class=\"fc-block-title\"></div>\r\n\t\t\t\t\t<div class=\"fc-block-actions\">\r\n\t\t\t\t\t\t<button class=\"fc-icon-btn fc-props-btn\" title=\"Edit block\" aria-label=\"Edit block\">\u2699</button>\r\n\t\t\t\t\t\t<button class=\"fc-icon-btn fc-del-btn\" title=\"Delete block\" aria-label=\"Delete block\">\u2715</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"fc-block-desc\"></div>\r\n\t\t\t\t<div class=\"fc-anchor\" title=\"Drag to connect\"></div>\r\n\t\t\t`;\r\n\t\t\tthis.root.appendChild(el);\r\n\t\t\tthis.attachBlockEvents(el, block.id);\r\n\t\t}\r\n\t\tel.style.left = block.position.x + 'px';\r\n\t\tel.style.top = block.position.y + 'px';\r\n\t\t(el.querySelector('.fc-block-title') as HTMLElement).textContent = block.title;\r\n\t\t(el.querySelector('.fc-block-desc') as HTMLElement).innerHTML = block.descriptionHtml;\r\n\t\t// Ensure observed for size changes\r\n\t\tif (!this.observed.has(block.id)) {\r\n\t\t\tthis.resizeObserver.observe(el);\r\n\t\t\tthis.observed.add(block.id);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateBlock(block: Block) {\r\n\t\tthis.renderBlock(block);\r\n\t}\r\n\r\n\tremoveBlock(id: BlockId) {\r\n\t\tconst el = document.getElementById(id);\r\n\t\tif (el) {\r\n\t\t\tthis.resizeObserver.unobserve(el);\r\n\t\t\tthis.observed.delete(id);\r\n\t\t\tel.remove();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate attachBlockEvents(el: HTMLElement, id: BlockId) {\r\n\t\tconst titleEl = el.querySelector('.fc-block-title') as HTMLElement;\r\n\t\tconst descEl = el.querySelector('.fc-block-desc') as HTMLElement;\r\n\t\tconst propsBtn = el.querySelector('.fc-props-btn') as HTMLButtonElement;\r\n\t\tconst delBtn = el.querySelector('.fc-del-btn') as HTMLButtonElement;\r\n\r\n\t\t// Selection (supports multi-select with Shift or toggle with Ctrl/Meta)\r\n\t\tel.addEventListener('mousedown', (e) => {\r\n\t\t\tif ((e.target as HTMLElement).closest('.fc-anchor')) return; // connection handled elsewhere\r\n\t\t\tconst state = this.deps.getState();\r\n\t\t\tconst multi = state.multiSelect as string[] | undefined;\r\n\t\t\tconst toggle = e.ctrlKey || e.metaKey; // toggle selection membership\r\n\t\t\t// Guard: if a true multi-selection (>1) exists, ignore plain clicks (no collapse)\r\n\t\t\tif (multi && multi.length > 1 && !toggle && !e.shiftKey) {\r\n\t\t\t\treturn; // preserve existing multi-selection\r\n\t\t\t}\r\n\t\t\tconst additive = e.shiftKey; // add to selection (only when no existing multi or user explicitly using shift)\r\n\t\t\tthis.selectBlock(id, additive, toggle);\r\n\t\t});\r\n\r\n\t\t// Drag start (single or multi-drag)\r\n\t\tel.addEventListener('pointerdown', (e) => {\r\n\t\t\tif ((e.target as HTMLElement).isContentEditable) return;\r\n\t\t\tif ((e.target as HTMLElement).closest('button')) return;\r\n\t\t\tif ((e.target as HTMLElement).closest('.fc-anchor')) return;\r\n\t\t\tconst rect = el.getBoundingClientRect();\r\n\t\t\t// Determine selection set for drag; ensure at least this block\r\n\t\t\tconst state = this.deps.getState();\r\n\t\t\tlet selected: string[] = state.multiSelect && state.multiSelect.length ? state.multiSelect : [id];\r\n\t\t\tif (!selected.includes(id)) selected = [id];\r\n\t\t\tconst initialPositions: Record<string, Point> = {};\r\n\t\t\tselected.forEach(bid => { const b = state.blocks[bid]; if (b) initialPositions[bid] = { ...b.position }; });\r\n\t\t\tthis.dragContext = { id, offset: { x: e.clientX - rect.left, y: e.clientY - rect.top }, initialPositions };\r\n\t\t\tel.classList.add('dragging');\r\n\t\t\t\t(this.deps as any).undoBegin?.('move-block');\r\n\t\t\tthis.deps.bus?.emit('block:drag:start', { id });\r\n\t\t\twindow.addEventListener('pointermove', this.onPointerMove);\r\n\t\t\twindow.addEventListener('pointerup', this.onPointerUp, { once: true });\r\n\t\t});\r\n\r\n\t\t// Double click to edit title\r\n\t\ttitleEl.addEventListener('dblclick', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.beginEdit(titleEl, 'title', id);\r\n\t\t});\r\n\t\t// Double click to edit description\r\n\t\tdescEl.addEventListener('dblclick', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.beginEdit(descEl, 'descriptionHtml', id, true);\r\n\t\t});\r\n\r\n\t\tpropsBtn.addEventListener('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.openPropertiesEditor(id);\r\n\t\t});\r\n\r\n\t\tdelBtn.addEventListener('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\t\t(this.deps as any).undoBegin?.('delete-block');\r\n\t\t\tthis.deps.dispatch({ type: 'DELETE_BLOCK', id });\r\n\t\t\tthis.removeBlock(id);\r\n\t\t\t\t(this.deps as any).undoCommit?.();\r\n\t\t});\r\n\t}\r\n\r\nprivate selectBlock(id: BlockId, additive = false, toggle = false) {\r\n\tconst state = this.deps.getState();\r\n\tlet current: string[] = state.multiSelect || [];\r\n\tif (!additive && !toggle) {\r\n\t\tcurrent = [id];\r\n\t} else if (toggle) {\r\n\t\tif (current.includes(id)) current = current.filter(b=> b!==id); else current = [...current, id];\r\n\t} else if (additive) {\r\n\t\tif (!current.includes(id)) current = [...current, id];\r\n\t}\r\n\tthis.deps.dispatch({ type: 'SELECT_BLOCK', id });\r\n\tthis.deps.dispatch({ type: 'SET_MULTI_SELECT', ids: current });\r\n\tthis.root.querySelectorAll('.fc-block').forEach(b => b.classList.remove('selected'));\r\n\tcurrent.forEach(bid => document.getElementById(bid)?.classList.add('selected'));\r\n}\r\n\r\n\tprivate onPointerMove = (e: PointerEvent) => {\r\n\t\tif (!this.dragContext) return;\r\n\t\tif (!this.rafDragging) {\r\n\t\t\tthis.rafDragging = true;\r\n\t\t\tthis.dragRafHandle = requestAnimationFrame(() => {\r\n\t\t\t\tthis.rafDragging = false;\r\n\t\t\t\tconst ctx = this.dragContext; // capture current drag context\r\n\t\t\t\tif (!ctx) return; // drag may have ended before RAF executed\r\n\t\t\t\tconst state = this.deps.getState();\r\n\t\t\t\tconst blk = state.blocks[ctx.id] as Block | undefined;\r\n\t\t\t\tif (!blk) return;\r\n\t\t\t\tconst canvasRect = this.root.getBoundingClientRect();\r\n\t\t\t\tconst vp = state.viewport;\r\n\t\t\t\tconst localX = (e.clientX - canvasRect.left) / vp.scale;\r\n\t\t\t\tconst localY = (e.clientY - canvasRect.top) / vp.scale;\r\n\t\t\t\tconst canvasW = this.root.clientWidth || parseInt((this.root as HTMLElement).getAttribute('data-test-width')||'0',10) || 1200;\r\n\t\t\t\tconst canvasH = this.root.clientHeight || parseInt((this.root as HTMLElement).getAttribute('data-test-height')||'0',10) || 800;\r\n\t\t\t\tconst originalPrimary = ctx.initialPositions[ctx.id];\r\n\t\t\t\tlet dx = (localX - ctx.offset.x) - originalPrimary.x;\r\n\t\t\t\tlet dy = (localY - ctx.offset.y) - originalPrimary.y;\r\n\t\t\t\tconst ids = Object.keys(ctx.initialPositions);\r\n\t\t\t\tif (ids.length > 1) {\r\n\t\t\t\t\t// Compute group bounding box after applying tentative delta\r\n\t\t\t\t\tlet minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n\t\t\t\t\tfor (const bid of ids) {\r\n\t\t\t\t\t\tconst ip = ctx.initialPositions[bid];\r\n\t\t\t\t\t\tconst b = state.blocks[bid]; if (!b) continue;\r\n\t\t\t\t\t\tconst nx = ip.x + dx; const ny = ip.y + dy;\r\n\t\t\t\t\t\tif (nx < minX) minX = nx;\r\n\t\t\t\t\t\tif (ny < minY) minY = ny;\r\n\t\t\t\t\t\tif (nx + b.size.width > maxX) maxX = nx + b.size.width;\r\n\t\t\t\t\t\tif (ny + b.size.height > maxY) maxY = ny + b.size.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Adjust delta so entire group stays within canvas\r\n\t\t\t\t\tif (minX < 0) dx += -minX;\r\n\t\t\t\t\tif (minY < 0) dy += -minY;\r\n\t\t\t\t\tif (maxX > canvasW) dx += (canvasW - maxX);\r\n\t\t\t\t\tif (maxY > canvasH) dy += (canvasH - maxY);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Single block clamp identical to previous logic\r\n\t\t\t\t\tlet newX = originalPrimary.x + dx;\r\n\t\t\t\t\tlet newY = originalPrimary.y + dy;\r\n\t\t\t\t\tlet maxX = canvasW - blk.size.width; if (maxX < 0) maxX = 0;\r\n\t\t\t\t\tlet maxY = canvasH - blk.size.height; if (maxY < 0) maxY = 0;\r\n\t\t\t\t\tif (newX < 0) newX = 0; else if (newX > maxX) newX = maxX;\r\n\t\t\t\t\tif (newY < 0) newY = 0; else if (newY > maxY) newY = maxY;\r\n\t\t\t\t\tdx = newX - originalPrimary.x;\r\n\t\t\t\t\tdy = newY - originalPrimary.y;\r\n\t\t\t\t}\r\n\t\t\t\tconst changes: { id: string; position: Point }[] = ids.map(bid => {\r\n\t\t\t\t\tconst ip = ctx.initialPositions[bid];\r\n\t\t\t\t\treturn { id: bid, position: { x: ip.x + dx, y: ip.y + dy } };\r\n\t\t\t\t});\r\n\t\t\t\tthis.deps.dispatch({ type: changes.length === 1 ? 'MOVE_BLOCK' : 'MULTIDRAG_BLOCKS', ...(changes.length === 1 ? { id: changes[0].id, position: changes[0].position } : { changes }) } as any);\r\n\t\t\t\tfor (const ch of changes) {\r\n\t\t\t\t\tconst el2 = document.getElementById(ch.id);\r\n\t\t\t\t\tif (el2) { el2.style.left = ch.position.x + 'px'; el2.style.top = ch.position.y + 'px'; }\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tprivate onPointerUp = () => {\r\n\t\tif (this.dragContext) {\r\n\t\t\tconst id = this.dragContext.id;\r\n\t\t\tdocument.getElementById(id)?.classList.remove('dragging');\r\n\t\t\tconst blk = this.deps.getState().blocks[id];\r\n\t\t\tif (blk) this.deps.bus?.emit('block:drag:end', { id, position: blk.position });\r\n\t\t}\r\n\t\twindow.removeEventListener('pointermove', this.onPointerMove);\r\n\t\tif (this.dragRafHandle !== null) { cancelAnimationFrame(this.dragRafHandle); this.dragRafHandle = null; this.rafDragging = false; }\r\n\t\tthis.dragContext = null;\r\n\t};\r\n\r\n\tprivate openPropertiesEditor(id: BlockId) {\r\n\t\tconst state = this.deps.getState();\r\n\t\tconst blk = state.blocks[id] as Block;\r\n\t\tif (!blk) return;\r\n\t\tconst popup = document.createElement('div');\r\n\t\tpopup.className = 'fc-props-popup fade-in';\r\n\t\tpopup.innerHTML = `\r\n\t\t\t<div class=\"fc-props-header\">Block Properties <button class=\"fc-close fc-btn\">\u2715</button></div>\r\n\t\t\t<div class=\"fc-props-body\">\r\n\t\t\t\t<div style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;\">\r\n\t\t\t\t\t<label style=\"font-size:12px; opacity:.8;\">JSON Properties</label>\r\n\t\t\t\t\t<small style=\"font-size:11px; opacity:.6;\">Esc to cancel</small>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"fc-json-editor-host\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"fc-props-footer\">\r\n\t\t\t\t<button class=\"fc-btn fc-cancel\">Cancel</button>\r\n\t\t\t\t<button class=\"fc-btn primary fc-save\" disabled>Save</button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\tdocument.body.appendChild(popup);\r\n\t\tconst close = () => popup.remove();\r\n\t\tpopup.querySelector('.fc-close')?.addEventListener('click', close);\r\n\t\tpopup.querySelector('.fc-cancel')?.addEventListener('click', close);\r\n\t\tconst saveBtn = popup.querySelector('.fc-save') as HTMLButtonElement;\r\n\t\tlet currentValue: any = blk.properties;\r\n\t\tconst host = popup.querySelector('.fc-json-editor-host') as HTMLElement;\r\n\t\tconst editor = new JsonEditor({\r\n\t\t\tvalue: blk.properties,\r\n\t\t\tonChange: v => { currentValue = v; },\r\n\t\t\tonValidity: valid => { saveBtn.disabled = !valid; }\r\n\t\t});\r\n\t\thost.appendChild(editor.root);\r\n\t\tsetTimeout(()=> editor.focus(), 30);\r\n\t\tpopup.querySelector('.fc-save')?.addEventListener('click', () => {\r\n\t\t\tif (saveBtn.disabled) return; // invalid\r\n\t\t\t(this.deps as any).undoBegin?.('edit-properties');\r\n\t\t\tthis.deps.dispatch({ type: 'UPDATE_BLOCK', id, patch: { properties: currentValue } });\r\n\t\t\t(this.deps as any).undoCommit?.();\r\n\t\t\tclose();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate beginEdit(el: HTMLElement, field: 'title' | 'descriptionHtml', id: BlockId, rich = false) {\r\n\t\tif (el.querySelector('.fc-wys-editor')) return; // already editing\r\n\t\tif (field === 'descriptionHtml' && rich) {\r\n\t\t\tconst original = el.innerHTML;\r\n\t\t\tconst editor = new WysiwygEditor({\r\n\t\t\t\tvalue: original,\r\n\t\t\t\tonSave: (html) => {\r\n\t\t\t\t\tthis.deps.dispatch({ type: 'UPDATE_BLOCK', id, patch: { descriptionHtml: html } });\r\n\t\t\t\t\tel.innerHTML = html; // render new html\r\n\t\t\t\t},\r\n\t\t\t\tonCancel: () => {\r\n\t\t\t\t\tel.innerHTML = original;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tel.innerHTML = '';\r\n\t\t\tel.appendChild(editor.root);\r\n\t\t\tsetTimeout(()=> editor.focus(), 20);\r\n\t\t\t// Remove editor after save/cancel buttons (handled inside component). Mutation done directly.\r\n\t\t\tconst finalize = () => {\r\n\t\t\t\tconst current = el.querySelector('.fc-wys-editor');\r\n\t\t\t\tif (current) {\r\n\t\t\t\t\t// If editor root still present but value already applied, replace with rendered content\r\n\t\t\t\t\tif (current.parentElement === el) {\r\n\t\t\t\t\t\t// nothing extra\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\teditor.root.addEventListener('click', (e) => {\r\n\t\t\t\tconst t = e.target as HTMLElement;\r\n\t\t\t\tif (t.classList.contains('fc-wys-save') || t.classList.contains('fc-wys-cancel')) {\r\n\t\t\t\t\t// Delay to allow onSave/onCancel to run\r\n\t\t\t\t\tsetTimeout(finalize, 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Simple inline contentEditable for title or non-rich fallback\r\n\t\tif (el.isContentEditable) return;\r\n\t\tconst original = field === 'title' ? (el.textContent || '') : el.innerHTML;\r\n\t\tel.contentEditable = 'true';\r\n\t\tel.classList.add('editing');\r\n\t\tel.focus();\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNodeContents(el);\r\n\t\trange.collapse(false);\r\n\t\tconst sel = window.getSelection();\r\n\t\tif (sel) { sel.removeAllRanges(); sel.addRange(range); }\r\n\t\tconst finish = (cancel: boolean) => {\r\n\t\t\tel.contentEditable = 'false';\r\n\t\t\tel.classList.remove('editing');\r\n\t\t\tif (!cancel) {\r\n\t\t\t\t(this.deps as any).undoBegin?.('edit-block');\r\n\t\t\t\tif (field === 'title') {\r\n\t\t\t\t\tthis.deps.dispatch({ type: 'UPDATE_BLOCK', id, patch: { title: el.textContent || '' } });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.deps.dispatch({ type: 'UPDATE_BLOCK', id, patch: { descriptionHtml: el.innerHTML } });\r\n\t\t\t\t}\r\n\t\t\t\t(this.deps as any).undoCommit?.();\r\n\t\t\t} else {\r\n\t\t\t\tif (field === 'title') el.textContent = original; else el.innerHTML = original;\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst keyHandler = (ev: KeyboardEvent) => {\r\n\t\t\tif (ev.key === 'Enter' && field === 'title') { ev.preventDefault(); finish(false); cleanup(); }\r\n\t\t\telse if (ev.key === 'Escape') { ev.preventDefault(); finish(true); cleanup(); }\r\n\t\t\telse if (ev.key === 'Enter' && field !== 'title' && !ev.shiftKey) { ev.preventDefault(); finish(false); cleanup(); }\r\n\t\t};\r\n\t\tconst blurHandler = () => { finish(false); cleanup(); };\r\n\t\tconst cleanup = () => {\r\n\t\t\tel.removeEventListener('keydown', keyHandler);\r\n\t\t\tel.removeEventListener('blur', blurHandler);\r\n\t\t};\r\n\t\tel.addEventListener('keydown', keyHandler);\r\n\t\tel.addEventListener('blur', blurHandler, { once: true });\r\n\t}\r\n\r\n}\r\n\r\n", "import { Action, AppState, Block, Connection, ConnectionId, ConnectionStyle, Point, uid } from './types.js';\r\nimport { EventBus, EventMap } from './EventBus.js';\r\n\r\ninterface Deps { dispatch(a: Action): void; getState(): AppState; bus?: EventBus<EventMap>; }\r\n\r\nexport class ConnectionManager {\r\n\tprivate svg: SVGSVGElement;\r\n\tprivate deps: Deps;\r\n\tprivate root: HTMLElement;\r\n\tprivate hoverConn: ConnectionId | null = null;\r\n\r\n\tconstructor(root: HTMLElement, deps: Deps) {\r\n\t\tthis.root = root;\r\n\t\tthis.deps = deps;\r\n\t\tthis.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n\t\tthis.svg.classList.add('fc-svg-layer');\r\n\t\tthis.root.appendChild(this.svg);\r\n\t}\r\n\r\n\trenderAll() {\r\n\t\tthis.svg.innerHTML = '';\r\n\t\tconst { connections } = this.deps.getState();\r\n\t\tObject.values(connections).forEach(c => this.renderConnection(c));\r\n\t}\r\n\r\n\tprivate getSourceAnchor(b: Block): Point {\r\n\t\tconst el = document.getElementById(b.id);\r\n\t\tif (el) {\r\n\t\t\tconst w = el.offsetWidth;\r\n\t\t\tconst h = el.offsetHeight;\r\n\t\t\treturn { x: b.position.x + w, y: b.position.y + h / 2 };\r\n\t\t}\r\n\t\treturn { x: b.position.x + b.size.width, y: b.position.y + b.size.height / 2 };\r\n\t}\r\n\r\n\tprivate getTargetAnchor(b: Block): Point {\r\n\t\tconst el = document.getElementById(b.id);\r\n\t\tif (el) {\r\n\t\t\tconst h = el.offsetHeight;\r\n\t\t\treturn { x: b.position.x, y: b.position.y + h / 2 };\r\n\t\t}\r\n\t\treturn { x: b.position.x, y: b.position.y + b.size.height / 2 };\r\n\t}\r\n\r\n\tprivate renderConnection(conn: Connection) {\r\n\t\tconst state = this.deps.getState();\r\n\t\tconst src = state.blocks[conn.source];\r\n\t\tconst tgt = state.blocks[conn.target];\r\n\t\tif (!src || !tgt) return;\r\n\t\tconst sp = this.getSourceAnchor(src);\r\n\t\tconst tp = this.getTargetAnchor(tgt);\r\n\r\n\t\tlet g = this.svg.querySelector(`[data-id=\"${conn.id}\"]`) as SVGGElement | null;\r\n\t\tlet path: SVGPathElement;\r\n\t\tlet trash: SVGGElement;\r\n\t\tlet labelDiv: HTMLDivElement;\r\n\t\tlet fObj: SVGForeignObjectElement;\r\n\t\tconst mid: Point = { x: (sp.x + tp.x) / 2, y: (sp.y + tp.y) / 2 };\r\n\t\tif (!g) {\r\n\t\t\tg = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n\t\t\tg.classList.add('fc-conn');\r\n\t\t\tg.dataset.id = conn.id;\r\n\t\t\tpath = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\t\t\tpath.classList.add('fc-conn-path');\r\n\t\t\tg.appendChild(path);\r\n\t\t\tthis.addDirectionMarkers(g, sp, tp, conn.style);\r\n\t\t\ttrash = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n\t\t\ttrash.classList.add('fc-conn-trash');\r\n\t\t\tconst rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n\t\t\trect.setAttribute('width', '16'); rect.setAttribute('height', '16'); rect.setAttribute('rx', '3');\r\n\t\t\tconst line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\t\t\tline1.setAttribute('x1', '4'); line1.setAttribute('y1', '4'); line1.setAttribute('x2', '12'); line1.setAttribute('y2', '12'); line1.setAttribute('stroke', '#ccc');\r\n\t\t\tconst line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\t\t\tline2.setAttribute('x1', '12'); line2.setAttribute('y1', '4'); line2.setAttribute('x2', '4'); line2.setAttribute('y2', '12'); line2.setAttribute('stroke', '#ccc');\r\n\t\t\ttrash.appendChild(rect); trash.appendChild(line1); trash.appendChild(line2);\r\n\t\t\tg.appendChild(trash);\r\n\t\t\tfObj = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');\r\n\t\t\tfObj.setAttribute('width', '140');\r\n\t\t\tfObj.setAttribute('height', '34');\r\n\t\t\tlabelDiv = document.createElement('div');\r\n\t\t\tlabelDiv.className = 'fc-conn-label fade';\r\n\t\t\tlabelDiv.textContent = conn.label ?? conn.id;\r\n\t\t\tfObj.appendChild(labelDiv as any);\r\n\t\t\tg.appendChild(fObj);\r\n\t\t\tlabelDiv.addEventListener('dblclick', (e) => {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tthis.beginLabelEdit(labelDiv, conn.id, labelDiv.textContent || conn.id);\r\n\t\t\t});\r\n\t\t\tlabelDiv.addEventListener('mouseenter', () => labelDiv.classList.add('hover')); // increase visibility on hover\r\n\t\t\tlabelDiv.addEventListener('mouseleave', () => labelDiv.classList.remove('hover'));\r\n\t\t\t// Events\r\n\t\t\tg.addEventListener('mouseenter', () => path.classList.add('hover'));\r\n\t\t\tg.addEventListener('mouseleave', () => path.classList.remove('hover'));\r\n\t\t\ttrash.addEventListener('click', (e) => { e.stopPropagation(); this.deleteConnection(conn.id); });\r\n\t\t\tpath.addEventListener('click', (e) => { e.stopPropagation(); this.selectConnection(conn.id); });\r\n\t\t\tthis.svg.appendChild(g);\r\n\t\t} else {\r\n\t\t\tpath = g.querySelector('.fc-conn-path') as SVGPathElement;\r\n\t\t\ttrash = g.querySelector('.fc-conn-trash') as SVGGElement;\r\n\t\t\tfObj = g.querySelector('foreignObject') as SVGForeignObjectElement;\r\n\t\t\tlabelDiv = fObj.querySelector('.fc-conn-label') as HTMLDivElement;\r\n\t\t\tlabelDiv.textContent = conn.label ?? conn.id;\r\n\t\t}\r\n\t\tpath.setAttribute('d', this.buildPath(sp, tp, conn.style));\r\n\t\ttrash.setAttribute('transform', `translate(${mid.x - 8}, ${mid.y - 8})`);\r\n\t\tthis.updateLabelPosition(fObj, mid);\r\n\t}\r\n\r\n\tprivate updateLabelPosition(fObj: SVGForeignObjectElement, mid: Point) {\r\n\t\tconst labelOffsetX = -50;\r\n\t\tconst labelOffsetY = -28;\r\n\t\tfObj.setAttribute('x', String(mid.x + labelOffsetX));\r\n\t\tfObj.setAttribute('y', String(mid.y + labelOffsetY));\r\n\t}\r\n\r\n\tprivate beginLabelEdit(el: HTMLElement, id: ConnectionId, original: string) {\r\n\t\tif (el.isContentEditable) return;\r\n\t\tel.setAttribute('contenteditable', 'true');\r\n\t\tel.classList.add('editing');\r\n\t\tel.classList.remove('fade');\r\n\t\tel.focus();\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNodeContents(el);\r\n\t\trange.collapse(false);\r\n\t\tconst sel = window.getSelection();\r\n\t\tif (sel) { sel.removeAllRanges(); sel.addRange(range); }\r\n\t\tconst finish = (cancel: boolean) => {\r\n\t\t\tel.contentEditable = 'false';\r\n\t\t\tel.classList.remove('editing');\r\n\t\t\tel.classList.add('fade');\r\n\t\t\tif (!cancel) {\r\n\t\t\t\tthis.deps.dispatch({ type: 'UPDATE_CONNECTION', id, patch: { label: el.textContent || '' } });\r\n\t\t\t} else {\r\n\t\t\t\tel.textContent = original;\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst keyHandler = (ev: KeyboardEvent) => {\r\n\t\t\tif (ev.key === 'Enter') { ev.preventDefault(); finish(false); cleanup(); }\r\n\t\t\telse if (ev.key === 'Escape') { ev.preventDefault(); finish(true); cleanup(); }\r\n\t\t};\r\n\t\tconst blurHandler = () => { finish(false); cleanup(); };\r\n\t\tconst cleanup = () => {\r\n\t\t\tel.removeEventListener('keydown', keyHandler);\r\n\t\t\tel.removeEventListener('blur', blurHandler);\r\n\t\t};\r\n\t\tel.addEventListener('keydown', keyHandler);\r\n\t\tel.addEventListener('blur', blurHandler, { once: true });\r\n\t}\r\n\r\n\tprivate addDirectionMarkers(group: SVGGElement, sp: Point, tp: Point, style: ConnectionStyle) {\r\n\t\tconst markers = 3; // number of markers excluding final head\r\n\t\tfor (let i=1; i<=markers; i++) {\r\n\t\t\tconst t = i/(markers+1);\r\n\t\t\tconst p = this.pointOnPath(sp, tp, style, t);\r\n\t\t\tconst nxt = this.pointOnPath(sp, tp, style, Math.min(t+0.01, 1));\r\n\t\t\tconst poly = this.buildDirectionPolygon(p, nxt, 9);\r\n\t\t\tgroup.appendChild(poly);\r\n\t\t}\r\n\t\t// Final arrowhead at endpoint\r\n\t\tconst head = this.buildDirectionPolygon({x: tp.x, y: tp.y}, tp, 12, true, sp);\r\n\t\tgroup.appendChild(head);\r\n\t}\r\n\r\n\tprivate pointOnPath(sp: Point, tp: Point, style: ConnectionStyle, t: number): Point {\r\n\t\tif (style === 'orthogonal') {\r\n\t\t\t// Piecewise linear: sp -> midX,sp.y -> midX,tp.y -> tp\r\n\t\t\tconst midX = (sp.x + tp.x) / 2;\r\n\t\t\t// lengths\r\n\t\t\tconst seg1 = Math.abs(midX - sp.x);\r\n\t\t\tconst seg2 = Math.abs(tp.y - sp.y);\r\n\t\t\tconst seg3 = Math.abs(tp.x - midX);\r\n\t\t\tconst total = seg1 + seg2 + seg3;\r\n\t\t\tlet d = t * total;\r\n\t\t\tif (d <= seg1) {\r\n\t\t\t\treturn { x: sp.x + (midX - sp.x) * (d/seg1), y: sp.y };\r\n\t\t\t}\r\n\t\t\td -= seg1;\r\n\t\t\tif (d <= seg2) {\r\n\t\t\t\treturn { x: midX, y: sp.y + (tp.y - sp.y) * (d/seg2) };\r\n\t\t\t}\r\n\t\t\td -= seg2;\r\n\t\t\treturn { x: midX + (tp.x - midX) * (d/seg3), y: tp.y };\r\n\t\t}\r\n\t\t// Bezier\r\n\t\tconst dx = (tp.x - sp.x) * 0.5;\r\n\t\tconst c1 = { x: sp.x + dx, y: sp.y };\r\n\t\tconst c2 = { x: tp.x - dx, y: tp.y };\r\n\t\t// Cubic Bezier formula\r\n\t\tconst u = 1 - t;\r\n\t\tconst x = u*u*u*sp.x + 3*u*u*t*c1.x + 3*u*t*t*c2.x + t*t*t*tp.x;\r\n\t\tconst y = u*u*u*sp.y + 3*u*u*t*c1.y + 3*u*t*t*c2.y + t*t*t*tp.y;\r\n\t\treturn { x, y };\r\n\t}\r\n\r\n\tprivate buildDirectionPolygon(p: Point, nxt: Point, size: number, solidHead=false, src?: Point): SVGPolygonElement {\r\n\t\tconst angle = Math.atan2(nxt.y - p.y, nxt.x - p.x);\r\n\t\tconst len = size;\r\n\t\tconst w = len * 0.6;\r\n\t\t// Triangle pointing from p toward nxt\r\n\t\tconst tipX = p.x + Math.cos(angle) * len;\r\n\t\tconst tipY = p.y + Math.sin(angle) * len;\r\n\t\tconst leftX = p.x + Math.cos(angle + Math.PI/2) * w/2;\r\n\t\tconst leftY = p.y + Math.sin(angle + Math.PI/2) * w/2;\r\n\t\tconst rightX = p.x + Math.cos(angle - Math.PI/2) * w/2;\r\n\t\tconst rightY = p.y + Math.sin(angle - Math.PI/2) * w/2;\r\n\t\tconst poly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');\r\n\t\tpoly.classList.add('fc-conn-dir');\r\n\t\tpoly.setAttribute('points', `${tipX},${tipY} ${leftX},${leftY} ${rightX},${rightY}`);\r\n\t\tif (solidHead) poly.classList.add('fc-conn-arrow');\r\n\t\treturn poly;\r\n\t}\r\n\r\n\tprivate buildPath(sp: Point, tp: Point, style: ConnectionStyle): string {\r\n\t\tif (style === 'orthogonal') {\r\n\t\t\tconst midX = (sp.x + tp.x) / 2;\r\n\t\t\treturn `M ${sp.x} ${sp.y} L ${midX} ${sp.y} L ${midX} ${tp.y} L ${tp.x} ${tp.y}`;\r\n\t\t}\r\n\t\t// default bezier\r\n\t\tconst dx = (tp.x - sp.x) * 0.5;\r\n\t\tconst c1x = sp.x + dx;\r\n\t\tconst c2x = tp.x - dx;\r\n\t\treturn `M ${sp.x} ${sp.y} C ${c1x} ${sp.y}, ${c2x} ${tp.y}, ${tp.x} ${tp.y}`;\r\n\t}\r\n\r\n\tprivate buildArrow(sp: Point, tp: Point): SVGPathElement {\r\n\t\tconst angle = Math.atan2(tp.y - sp.y, tp.x - sp.x);\r\n\t\tconst size = 10;\r\n\t\tconst ax = tp.x - Math.cos(angle) * 12;\r\n\t\tconst ay = tp.y - Math.sin(angle) * 12;\r\n\t\tconst p1x = ax + Math.cos(angle + Math.PI / 2) * size * 0.4;\r\n\t\tconst p1y = ay + Math.sin(angle + Math.PI / 2) * size * 0.4;\r\n\t\tconst p2x = ax + Math.cos(angle - Math.PI / 2) * size * 0.4;\r\n\t\tconst p2y = ay + Math.sin(angle - Math.PI / 2) * size * 0.4;\r\n\t\tconst path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\t\tpath.classList.add('fc-conn-arrow');\r\n\t\tpath.setAttribute('d', `M ${tp.x} ${tp.y} L ${p1x} ${p1y} L ${p2x} ${p2y} Z`);\r\n\t\treturn path;\r\n\t}\r\n\r\n\taddConnection(source: string, target: string): string | undefined {\r\n\t\tif (source === target) return;\r\n\t\tconst state = this.deps.getState();\r\n\t\t// prevent duplicate\r\n\t\tif (Object.values(state.connections).some(c => c.source === source && c.target === target)) return;\r\n\t\tconst newId = uid('conn');\r\n\t\tconst conn: Connection = { id: newId, source, target, style: state.connectionStyle, label: newId };\r\n\t\tthis.deps.dispatch({ type: 'ADD_CONNECTION', connection: conn });\r\n\t\tthis.deps.bus?.emit('connection:added', { id: conn.id, sourceId: source, targetId: target });\r\n\t\treturn conn.id;\r\n\t}\r\n\r\n\tdeleteConnection(id: ConnectionId) {\r\n\t\tthis.deps.dispatch({ type: 'DELETE_CONNECTION', id });\r\n\t\t// full rerender handled externally\r\n\t}\r\n\r\n\tupdateConnectionsForBlock(blockId: string) {\r\n\t\t// Rerender all connections that involve block\r\n\t\tconst state = this.deps.getState();\r\n\t\tconst related = Object.values(state.connections).filter(c => c.source === blockId || c.target === blockId);\r\n\t\trelated.forEach(c => this.svg.querySelector(`[data-id=\"${c.id}\"]`)?.remove());\r\n\t\trelated.forEach(c => this.renderConnection(c));\r\n\t}\r\n\r\n\tselectConnection(id: ConnectionId) {\r\n\t\tconst state = this.deps.getState();\r\n\t\tif (!state.connections[id]) return;\r\n\t\tthis.deps.dispatch({ type: 'SELECT_CONNECTION', id });\r\n\t\tthis.svg.querySelectorAll('.fc-conn').forEach(g => g.classList.remove('selected'));\r\n\t\tthis.svg.querySelector(`[data-id=\"${id}\"]`)?.classList.add('selected');\r\n\t}\r\n}\r\n\r\n", "import { ToolbarDeps } from '../Toolbar.js';\r\n\r\nexport class SaveLoadManager {\r\n  constructor(private deps: ToolbarDeps) {}\r\n\r\n  buildDataMenuItems(closeMenus: ()=>void) {\r\n    return [\r\n      { label:'Save Chart', action: ()=> this.openSaveDialog(closeMenus) },\r\n      { label:'Load Chart', action: ()=> this.openLoadDialog(closeMenus) },\r\n      { label:'---', action: ()=> {} },\r\n      { label:'Export JSON', action: ()=> { closeMenus(); this.deps.exportJSON(); } },\r\n      { label:'Import JSON', action: ()=> { closeMenus(); this.deps.importJSON(); } },\r\n      { label:'Clear All', action: ()=> { if (confirm('Clear all blocks and connections?')) { this.deps.clearAll(); } }, danger:true }\r\n    ];\r\n  }\r\n\r\n  openSaveDialog(closeMenus: ()=>void) {\r\n    closeMenus();\r\n    const backdrop = document.createElement('div'); backdrop.className='backdrop';\r\n    const modal = document.createElement('div'); modal.className='fc-theme-modal fade-in';\r\n    const applyResponsiveSize = () => {\r\n      const vw = window.innerWidth;\r\n      const target = Math.min(780, Math.max(480, Math.floor(vw * 0.9)));\r\n      modal.style.width = target + 'px';\r\n      modal.style.maxHeight = Math.min(window.innerHeight * 0.9, 720) + 'px';\r\n    };\r\n    applyResponsiveSize();\r\n    window.addEventListener('resize', applyResponsiveSize, { once: true });\r\n    modal.innerHTML = `<h2>Save Chart</h2><div class=\"body\">\r\n      <div class=\"hint\">Provide a name to save the current chart locally. Existing names require confirmation to overwrite.</div>\r\n      <input type=\"text\" class=\"chart-name\" placeholder=\"chart-name\" style=\"padding:6px 8px; font-size:13px; border:1px solid var(--fc-border-strong); background:var(--fc-bg); color:var(--fc-text); border-radius:4px;\" />\r\n      <div class=\"err\" style=\"display:none\"></div>\r\n    </div>\r\n    <div class=\"actions\">\r\n      <button class=\"fc-btn\" data-act=\"cancel\">Cancel</button>\r\n      <button class=\"fc-btn primary\" data-act=\"save\">Save</button>\r\n    </div>`;\r\n    const remove = ()=> { backdrop.remove(); modal.remove(); };\r\n    backdrop.addEventListener('click', remove);\r\n    document.body.appendChild(backdrop); document.body.appendChild(modal);\r\n    const nameInput = modal.querySelector('.chart-name') as HTMLInputElement;\r\n    const errEl = modal.querySelector('.err') as HTMLElement;\r\n    modal.querySelector('[data-act=\"cancel\"]')?.addEventListener('click', remove);\r\n    modal.querySelector('[data-act=\"save\"]')?.addEventListener('click', () => {\r\n      errEl.style.display='none';\r\n      const name = (nameInput.value||'').trim();\r\n      if (!name) { errEl.textContent='Name required'; errEl.style.display='block'; return; }\r\n      try {\r\n        const app = (window as any).flowchartApp; if (!app) throw new Error('App missing');\r\n        const state = app.store.getState();\r\n        const wrapper = { savedAt: new Date().toISOString(), state };\r\n        const key = 'fc-saved-charts';\r\n        const existingRaw = localStorage.getItem(key);\r\n        let list: any[] = existingRaw ? JSON.parse(existingRaw) : [];\r\n        const already = list.find(x => x.name === name);\r\n        if (already) {\r\n          if (!confirm(`Overwrite existing chart \"${name}\"?`)) { return; }\r\n          list = list.filter(x => x.name !== name);\r\n        } else {\r\n          list = list.filter(x => x.name !== name);\r\n        }\r\n        list.push({ name, ...wrapper });\r\n        localStorage.setItem(key, JSON.stringify(list));\r\n        this.deps.updateStatus('Saved chart: '+name);\r\n        remove();\r\n      } catch(e:any) {\r\n        errEl.textContent = 'Error: '+ e.message;\r\n        errEl.style.display='block';\r\n      }\r\n    });\r\n    nameInput.focus();\r\n  }\r\n\r\n  openLoadDialog(closeMenus: ()=>void) {\r\n    closeMenus();\r\n    const key = 'fc-saved-charts';\r\n    let list: any[] = [];\r\n    try { const raw = localStorage.getItem(key); if (raw) list = JSON.parse(raw); } catch {}\r\n    const backdrop = document.createElement('div'); backdrop.className='backdrop';\r\n    const modal = document.createElement('div'); modal.className='fc-theme-modal fade-in';\r\n    modal.innerHTML = `<h2>Load Chart</h2><div class=\"body\">\r\n      <div class=\"hint\">Select a chart to load. Current unsaved changes will be lost.</div>\r\n      <div class=\"toolbar-row\" style=\"display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin:4px 0 6px;\">\r\n        <div style=\"display:flex; gap:6px;\">\r\n          <button class=\"fc-btn small\" data-sort=\"date\">Sort: Date</button>\r\n          <button class=\"fc-btn small\" data-sort=\"name\">Sort: Name</button>\r\n        </div>\r\n        <input type=\"text\" placeholder=\"Search...\" class=\"chart-search\" style=\"flex:1 1 160px; min-width:140px; padding:4px 6px; font-size:12px; border:1px solid var(--fc-border-strong); background:var(--fc-bg); color:var(--fc-text); border-radius:4px;\" />\r\n      </div>\r\n      <div class=\"chart-list\" style=\"display:flex; flex-direction:column; gap:8px; transition:all .15s ease;\"></div>\r\n      <div class=\"pager\" style=\"display:none; justify-content:space-between; align-items:center; margin-top:10px; gap:12px;\">\r\n        <button class=\"fc-btn small\" data-page=\"prev\" disabled>Prev</button>\r\n        <div class=\"page-info\" style=\"font-size:11px; opacity:.75;\">Page 1</div>\r\n        <button class=\"fc-btn small\" data-page=\"next\" disabled>Next</button>\r\n      </div>\r\n      <div class=\"err\" style=\"display:none\"></div>\r\n    </div>\r\n    <div class=\"actions\">\r\n      <button class=\"fc-btn\" data-act=\"close\">Close</button>\r\n    </div>`;\r\n    const remove = ()=> { backdrop.remove(); modal.remove(); };\r\n    backdrop.addEventListener('click', remove);\r\n    document.body.appendChild(backdrop); document.body.appendChild(modal);\r\n    modal.querySelector('[data-act=\"close\"]')?.addEventListener('click', remove);\r\n    const listEl = modal.querySelector('.chart-list') as HTMLElement;\r\n    const errEl = modal.querySelector('.err') as HTMLElement;\r\n    const searchInput = modal.querySelector('.chart-search') as HTMLInputElement;\r\n    const pagerEl = modal.querySelector('.pager') as HTMLElement;\r\n    const prevBtn = pagerEl.querySelector('[data-page=\"prev\"]') as HTMLButtonElement;\r\n    const nextBtn = pagerEl.querySelector('[data-page=\"next\"]') as HTMLButtonElement;\r\n    const pageInfo = pagerEl.querySelector('.page-info') as HTMLElement;\r\n    let sortMode: 'date'|'name' = 'date';\r\n    let filterText = '';\r\n    let page = 1;\r\n    const pageSize = 24;\r\n\r\n    const validateState = (obj: any): string | null => {\r\n      if (!obj || typeof obj !== 'object') return 'State not an object';\r\n      if (!obj.blocks || typeof obj.blocks !== 'object') return 'Missing blocks map';\r\n      if (!obj.connections || typeof obj.connections !== 'object') return 'Missing connections map';\r\n      for (const [id,b] of Object.entries<any>(obj.blocks)) {\r\n        if (!b || typeof b !== 'object') return 'Invalid block entry';\r\n        if (b.id !== id) return 'Block id mismatch';\r\n        if (typeof b.kind !== 'string') return 'Block kind missing';\r\n        if (!b.position || typeof b.position.x !== 'number' || typeof b.position.y !== 'number') return 'Block position invalid';\r\n        if (!b.size || typeof b.size.width !== 'number' || typeof b.size.height !== 'number') return 'Block size invalid';\r\n      }\r\n      for (const [id,c] of Object.entries<any>(obj.connections)) {\r\n        if (!c || typeof c !== 'object') return 'Invalid connection entry';\r\n        if (c.id !== id) return 'Connection id mismatch';\r\n        if (typeof c.source !== 'string' || typeof c.target !== 'string') return 'Connection endpoints invalid';\r\n      }\r\n      return null;\r\n    };\r\n\r\n    const buildRows = (entries: any[]) => {\r\n      listEl.innerHTML='';\r\n      if (entries.length === 0) {\r\n        listEl.innerHTML = '<div style=\"opacity:.7;font-size:12px;\">No saved charts.</div>';\r\n        return;\r\n      }\r\n      const many = entries.length > 12 && window.innerWidth > 900;\r\n      if (many) {\r\n        listEl.style.display='grid';\r\n        listEl.style.gridTemplateColumns='1fr 1fr';\r\n      } else {\r\n        listEl.style.display='flex';\r\n        listEl.style.flexDirection='column';\r\n      }\r\n      entries.forEach(entry => {\r\n        const row = document.createElement('div');\r\n        row.className='fc-menu-item';\r\n        row.style.display='flex';\r\n        row.style.alignItems='center';\r\n        row.style.gap='8px';\r\n        row.style.height='auto';\r\n        const loadBtn = document.createElement('button');\r\n        loadBtn.className='fc-btn small';\r\n        loadBtn.textContent='Load';\r\n        const delBtn = document.createElement('button');\r\n        delBtn.className='fc-btn small danger';\r\n        delBtn.textContent='\u2715';\r\n        const meta = document.createElement('div');\r\n        meta.style.display='flex';\r\n        meta.style.flexDirection='column';\r\n        meta.style.alignItems='flex-start';\r\n        meta.style.flex='1 1 auto';\r\n        const time = new Date(entry.savedAt).toLocaleString();\r\n        meta.innerHTML = `<span style=\"font-size:12px;\">${entry.name}</span><span style=\"opacity:.6;font-size:10px;\">${time}</span>`;\r\n        loadBtn.addEventListener('click', (ev) => {\r\n          ev.stopPropagation();\r\n          try {\r\n            const app = (window as any).flowchartApp; if (!app) throw new Error('App missing');\r\n            const err = validateState(entry.state);\r\n            if (err) { alert('Invalid saved chart: '+err); return; }\r\n            app.store.dispatch({ type:'BULK_SET_STATE', state: entry.state });\r\n            app['blockManager']?.renderAll();\r\n            app['connectionManager']?.renderAll();\r\n            app['applyViewport']?.();\r\n            app['applyGridOverlay']?.();\r\n            app['undoBegin']?.('load-chart');\r\n            app['undoCommit']?.();\r\n            this.deps.updateStatus('Loaded chart: '+entry.name);\r\n            remove();\r\n          } catch(e:any) {\r\n            alert('Failed to load chart: '+e.message);\r\n          }\r\n        });\r\n        delBtn.addEventListener('click', (ev) => {\r\n          ev.stopPropagation();\r\n          if (!confirm(`Delete saved chart \"${entry.name}\"? This cannot be undone.`)) return;\r\n          list = list.filter(x => x !== entry);\r\n          try { localStorage.setItem(key, JSON.stringify(list)); } catch {}\r\n          render();\r\n        });\r\n        row.appendChild(loadBtn);\r\n        row.appendChild(meta);\r\n        row.appendChild(delBtn);\r\n        listEl.appendChild(row);\r\n      });\r\n    };\r\n\r\n    const filterAndSlice = () => {\r\n      if (list.length === 0) { buildRows([]); pagerEl.style.display='none'; return; }\r\n      if (sortMode === 'date') list.sort((a,b)=> new Date(b.savedAt).getTime() - new Date(a.savedAt).getTime());\r\n      else list.sort((a,b)=> (a.name||'').localeCompare(b.name||''));\r\n      const filtered = filterText ? list.filter(e => (e.name||'').toLowerCase().includes(filterText)) : list.slice();\r\n      const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));\r\n      if (page > totalPages) page = totalPages;\r\n      const start = (page-1)*pageSize;\r\n      const pageEntries = filtered.slice(start, start + pageSize);\r\n      buildRows(pageEntries);\r\n      if (filtered.length > pageSize) {\r\n        pagerEl.style.display='flex';\r\n        prevBtn.disabled = page === 1;\r\n        nextBtn.disabled = page === totalPages;\r\n        pageInfo.textContent = `Page ${page} / ${totalPages} (${filtered.length} items)`;\r\n      } else {\r\n        pagerEl.style.display='none';\r\n      }\r\n    };\r\n\r\n    const render = () => { filterAndSlice(); };\r\n\r\n    modal.querySelectorAll('[data-sort]').forEach(btn => {\r\n      btn.addEventListener('click', () => {\r\n        sortMode = (btn as HTMLElement).getAttribute('data-sort') === 'name' ? 'name' : 'date';\r\n        page = 1; render();\r\n      });\r\n    });\r\n    const doFilter = () => { filterText = (searchInput.value||'').trim().toLowerCase(); page = 1; render(); };\r\n    let filterTimer: any;\r\n    searchInput.addEventListener('input', () => { clearTimeout(filterTimer); filterTimer = setTimeout(doFilter, 160); });\r\n    prevBtn.addEventListener('click', ()=> { if (page>1){ page--; render(); } });\r\n    nextBtn.addEventListener('click', ()=> { page++; render(); });\r\n\r\n    render();\r\n  }\r\n}\r\n", "import { ToolbarDeps } from '../Toolbar.js';\r\n\r\nexport class ThemeMenu {\r\n  private currentMenu: HTMLElement | null = null;\r\n  constructor(private deps: ToolbarDeps) {}\r\n\r\n  open(btn: HTMLElement, closeMenus: ()=>void) {\r\n    // Toggle behaviour: if already open, just close.\r\n    if (btn.getAttribute('data-open')==='true') { this.closeMenu(closeMenus); return; }\r\n    closeMenus();\r\n    const menu = document.createElement('div'); menu.className='fc-menu'; menu.dataset.menu='theme';\r\n    this.currentMenu = menu;\r\n    const themes = [\r\n      'dark','light','high-contrast','blue','green','purple',\r\n      'light-blue','light-green','light-orange','light-gray','light-contrast'\r\n    ];\r\n    const tm = (window as any).flowchartApp?.themeManager;\r\n    themes.forEach(name => {\r\n      const item = document.createElement('button'); item.className='fc-menu-item theme-item';\r\n      const sw = document.createElement('div'); sw.className='fc-theme-swatch';\r\n      const stack = document.createElement('div'); stack.className='fc-theme-swatch-stack';\r\n      const a = document.createElement('span'); const b = document.createElement('span');\r\n      let pv: any;\r\n      if (tm && tm.ensurePreviewForBuiltin) {\r\n        pv = tm.ensurePreviewForBuiltin(name);\r\n        a.style.background = pv.bg; b.style.background = pv.accent;\r\n      } else { a.style.background = '#ffffff'; b.style.background = '#4ea1ff'; }\r\n      stack.appendChild(a); stack.appendChild(b); sw.appendChild(stack);\r\n      const labelWrap = document.createElement('div'); labelWrap.className='label-wrap';\r\n      labelWrap.innerHTML = `<span>${name}</span>`;\r\n      item.appendChild(sw); item.appendChild(labelWrap);\r\n  item.addEventListener('click', () => { this.deps.setTheme(name); this.deps.updateStatus('Theme: '+name); this.closeMenu(closeMenus); });\r\n      menu.appendChild(item);\r\n    });\r\n    const sep=document.createElement('div'); sep.className='fc-menu-group-sep'; menu.appendChild(sep);\r\n    const customBtn=document.createElement('button'); customBtn.className='fc-menu-item'; customBtn.textContent='Add Custom Theme';\r\n  customBtn.addEventListener('click', () => { this.closeMenu(closeMenus); this.openCustomThemeModal(); });\r\n    menu.appendChild(customBtn);\r\n    document.body.appendChild(menu);\r\n    // Position then clamp to viewport\r\n    const rect = btn.getBoundingClientRect();\r\n    const vpW = window.innerWidth; const vpH = window.innerHeight;\r\n    // Initial preferred position (above & right aligned)\r\n    let top = rect.top - menu.offsetHeight - 8;\r\n    let left = rect.left - menu.offsetWidth + rect.width;\r\n    // If above goes off screen, place below\r\n    if (top < 0) top = rect.bottom + 8;\r\n    // Clamp horizontally & vertically\r\n    if (left + menu.offsetWidth > vpW - 4) left = vpW - menu.offsetWidth - 4;\r\n    if (left < 4) left = 4;\r\n    if (top + menu.offsetHeight > vpH - 4) top = Math.max(4, vpH - menu.offsetHeight - 4);\r\n    menu.style.top = top + 'px';\r\n    menu.style.left = left + 'px';\r\n    btn.setAttribute('data-open','true');\r\n\r\n    // Outside click & escape handling specific to this menu so it can self-close.\r\n    const onPointerDown = (e: PointerEvent) => {\r\n      if (!this.currentMenu) return;\r\n      if (!(e.target as HTMLElement).closest('.fc-menu') && !(e.target as HTMLElement).closest('[data-menu-btn=\"theme\"]')) {\r\n        this.closeMenu(closeMenus);\r\n        window.removeEventListener('pointerdown', onPointerDown, true);\r\n        window.removeEventListener('keydown', onKeyDown, true);\r\n      }\r\n    };\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        this.closeMenu(closeMenus);\r\n        window.removeEventListener('pointerdown', onPointerDown, true);\r\n        window.removeEventListener('keydown', onKeyDown, true);\r\n      }\r\n    };\r\n    // Capture phase so it fires before toolbar global handler if any\r\n    window.addEventListener('pointerdown', onPointerDown, true);\r\n    window.addEventListener('keydown', onKeyDown, true);\r\n  }\r\n\r\n  private openCustomThemeModal() {\r\n    const backdrop = document.createElement('div'); backdrop.className='backdrop';\r\n    const modal = document.createElement('div'); modal.className='fc-theme-modal fade-in';\r\n    modal.innerHTML = `<h2>Custom Theme</h2><div class=\"body\">\r\n      <div class=\"hint\">Paste JSON mapping of CSS variables to values. Only keys starting with <code>--fc-</code> are applied.</div>\r\n      <input type=\"text\" placeholder=\"theme-name\" class=\"name\" style=\"padding:6px 8px; font-size:13px; border:1px solid var(--fc-border-strong); background:var(--fc-bg); color:var(--fc-text); border-radius:4px;\" />\r\n      <textarea class=\"vars\" placeholder='{\"--fc-bg\":\"#ffffff\",\"--fc-accent\":\"#2563eb\",\"--fc-text\":\"#111827\"}'></textarea>\r\n      <div class=\"err\" style=\"display:none\"></div>\r\n    </div>\r\n    <div class=\"actions\">\r\n      <button class=\"fc-btn\" data-act=\"cancel\">Cancel</button>\r\n      <button class=\"fc-btn primary\" data-act=\"save\">Save Theme</button>\r\n    </div>`;\r\n  const remove = () => { backdrop.remove(); modal.remove(); };\r\n    backdrop.addEventListener('click', remove);\r\n    document.body.appendChild(backdrop); document.body.appendChild(modal);\r\n    const nameInput = modal.querySelector('.name') as HTMLInputElement;\r\n    const textarea = modal.querySelector('.vars') as HTMLTextAreaElement;\r\n    const errEl = modal.querySelector('.err') as HTMLElement;\r\n    modal.querySelector('[data-act=\"cancel\"]')?.addEventListener('click', remove);\r\n    modal.querySelector('[data-act=\"save\"]')?.addEventListener('click', () => {\r\n      errEl.style.display='none';\r\n      const name = (nameInput.value || '').trim();\r\n      if (!name) { errEl.textContent='Name required'; errEl.style.display='block'; return; }\r\n      let parsed: any; try { parsed = JSON.parse(textarea.value || '{}'); } catch(e:any) { errEl.textContent='Invalid JSON: '+e.message; errEl.style.display='block'; return; }\r\n      const filtered: Record<string,string> = {};\r\n      Object.entries(parsed).forEach(([k,v])=> { if (k.startsWith('--fc-') && typeof v === 'string') filtered[k]=v; });\r\n      if (Object.keys(filtered).length === 0) { errEl.textContent='No valid --fc- variables found.'; errEl.style.display='block'; return; }\r\n      if ((window as any).flowchartApp?.themeManager?.registerCustom) {\r\n        (window as any).flowchartApp.themeManager.registerCustom(name, filtered);\r\n      }\r\n      this.deps.setTheme(name);\r\n      this.deps.updateStatus('Theme: '+name+' (custom)');\r\n      remove();\r\n    });\r\n  }\r\n\r\n  private closeMenu(closeMenus: ()=>void) {\r\n    if (this.currentMenu) {\r\n      this.currentMenu.remove();\r\n      this.currentMenu = null;\r\n    }\r\n    closeMenus();\r\n  }\r\n}\r\n", "import { ToolbarDeps } from '../Toolbar.js';\r\n\r\nexport class ArrangeMenu {\r\n  constructor(private deps: ToolbarDeps) {}\r\n\r\n  buildItems() {\r\n    return [\r\n      { label:'Align Left', action: ()=> this.deps.arrange('align-left') },\r\n      { label:'Align Center', action: ()=> this.deps.arrange('align-center') },\r\n      { label:'Align Right', action: ()=> this.deps.arrange('align-right') },\r\n      { label:'Align Top', action: ()=> this.deps.arrange('align-top') },\r\n      { label:'Align Middle', action: ()=> this.deps.arrange('align-middle') },\r\n      { label:'Align Bottom', action: ()=> this.deps.arrange('align-bottom') },\r\n      { label:'---', action: ()=> {} },\r\n      { label:'Distribute Horizontal', action: ()=> this.deps.arrange('dist-h') },\r\n      { label:'Distribute Vertical', action: ()=> this.deps.arrange('dist-v') }\r\n    ];\r\n  }\r\n}\r\n", "import { ToolbarDeps } from '../Toolbar.js';\r\n\r\nexport class ConnectionStyleMenu {\r\n  constructor(private deps: ToolbarDeps) {}\r\n  buildItems() {\r\n    return [\r\n      { label:'Bezier', action: ()=> { this.deps.setConnectionStyle('bezier'); this.deps.updateStatus('Style: bezier'); } },\r\n      { label:'Orthogonal', action: ()=> { this.deps.setConnectionStyle('orthogonal'); this.deps.updateStatus('Style: orthogonal'); } }\r\n    ];\r\n  }\r\n}\r\n", "import { BlockKind } from './types.js';\r\nimport { SaveLoadManager } from './toolbar/SaveLoadManager.js';\r\nimport { ThemeMenu } from './toolbar/ThemeMenu.js';\r\nimport { ArrangeMenu } from './toolbar/ArrangeMenu.js';\r\nimport { ConnectionStyleMenu } from './toolbar/ConnectionStyleMenu.js';\r\n\r\nexport interface ToolbarDeps {\r\n  createBlock(kind: BlockKind, pos: {x:number;y:number}): void;\r\n  setConnectionStyle(style: 'bezier'|'orthogonal'): void;\r\n  exportJSON(): void;\r\n  importJSON(): void;\r\n  clearAll(): void;\r\n  setTheme(theme: string): void;\r\n  resetView(): void;\r\n  randomPosition(): {x:number;y:number};\r\n  updateStatus(msg: string): void;\r\n  undo(): void;\r\n  redo(): void;\r\n  toggleGrid(): void;\r\n  gridEnabled(): boolean;\r\n  arrange(kind: string): void; // kind: align-left|align-center|align-right|align-top|align-middle|align-bottom|dist-h|dist-v\r\n  toggleMinimap(): void;\r\n  minimapEnabled(): boolean;\r\n}\r\n\r\nexport class Toolbar {\r\n  private deps: ToolbarDeps;\r\n  private root: HTMLElement;\r\n  private openMenus: { [key:string]: HTMLElement } = {};\r\n  // Extracted feature modules\r\n  private saveLoad: SaveLoadManager;\r\n  private themeMenu: ThemeMenu;\r\n  private arrangeMenu: ArrangeMenu;\r\n  private styleMenu: ConnectionStyleMenu;\r\n\r\n  constructor(container: HTMLElement, deps: ToolbarDeps) {\r\n    this.deps = deps;\r\n  this.root = document.createElement('div');\r\n    this.root.className = 'fc-toolbar';\r\n    this.root.innerHTML = `\r\n      <button title=\"Undo\" data-act=\"undo\">\u21BA</button>\r\n      <button title=\"Redo\" data-act=\"redo\">\u21BB</button>\r\n      <button title=\"Add Block\" data-menu-btn=\"add\">\u2795</button>\r\n      <button title=\"Connection Style\" data-menu-btn=\"style\">\uD83E\uDDEC</button>\r\n      <button title=\"Data\" data-menu-btn=\"data\">\uD83D\uDDC2</button>\r\n      <button title=\"Theme\" data-menu-btn=\"theme\">\uD83C\uDFA8</button>\r\n      <button title=\"Grid\" data-act=\"grid\">#</button>\r\n  <button title=\"Arrange\" data-menu-btn=\"arrange\">\uD83D\uDCD0</button>\r\n  <button title=\"Reset View\" data-act=\"resetView\">\uD83E\uDDED</button>\r\n  <button title=\"Minimap\" data-act=\"minimap\">\uD83D\uDDFA</button>\r\n    `;\r\n    container.appendChild(this.root);\r\n    // Instantiate feature modules\r\n    this.saveLoad = new SaveLoadManager(deps);\r\n    this.themeMenu = new ThemeMenu(deps);\r\n    this.arrangeMenu = new ArrangeMenu(deps);\r\n    this.styleMenu = new ConnectionStyleMenu(deps);\r\n    this.attachEvents();\r\n  }\r\n\r\n  getElement() { return this.root; }\r\n\r\n  private attachEvents() {\r\n    window.addEventListener('pointerdown', (e) => {\r\n      if (!(e.target as HTMLElement).closest('.fc-toolbar') && !(e.target as HTMLElement).closest('.fc-menu')) {\r\n        this.closeAllMenus();\r\n      }\r\n    });\r\n    this.root.addEventListener('click', (e) => {\r\n        const btn = (e.target as HTMLElement).closest('button'); if (!btn) return;\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      if (btn.dataset.act) {\r\n        switch(btn.dataset.act) {\r\n          case 'resetView': this.deps.resetView(); this.closeAllMenus(); return;\r\n          case 'undo': this.deps.undo(); return;\r\n          case 'redo': this.deps.redo(); return;\r\n          case 'grid': this.deps.toggleGrid(); btn.classList.toggle('active', this.deps.gridEnabled()); return;\r\n          case 'minimap': this.deps.toggleMinimap(); btn.classList.toggle('active', this.deps.minimapEnabled()); return;\r\n        }\r\n      }\r\n      if (!btn.dataset.menuBtn) return;\r\n      switch(btn.dataset.menuBtn) {\r\n        case 'add':\r\n          return this.toggleMenu('add', btn, [\r\n            { label:'Start', action: ()=> this.deps.createBlock('start', this.deps.randomPosition()) },\r\n            { label:'Process', action: ()=> this.deps.createBlock('process', this.deps.randomPosition()) },\r\n            { label:'Decision', action: ()=> this.deps.createBlock('decision', this.deps.randomPosition()) },\r\n            { label:'I/O', action: ()=> this.deps.createBlock('io', this.deps.randomPosition()) },\r\n            { label:'End', action: ()=> this.deps.createBlock('end', this.deps.randomPosition()) }\r\n          ]);\r\n        case 'style':\r\n          return this.toggleMenu('style', btn, this.styleMenu.buildItems());\r\n        case 'data':\r\n          return this.toggleMenu('data', btn, this.saveLoad.buildDataMenuItems(()=>this.closeAllMenus()));\r\n        case 'theme':\r\n          return this.themeMenu.open(btn, ()=>this.closeAllMenus());\r\n        case 'arrange':\r\n          return this.toggleMenu('arrange', btn, this.arrangeMenu.buildItems());\r\n      }\r\n    });\r\n  }\r\n\r\n  private buildMenu(id: string, items: { label: string; action: () => void; danger?: boolean }[]) {\r\n    const menu = document.createElement('div'); menu.className='fc-menu'; menu.dataset.menu=id;\r\n    items.forEach(it => {\r\n      if (it.label === '---') { const sep=document.createElement('div'); sep.className='fc-menu-group-sep'; menu.appendChild(sep); return; }\r\n      const btn=document.createElement('button'); btn.className='fc-menu-item'+(it.danger?' danger':''); btn.textContent=it.label; btn.addEventListener('click', () => { it.action(); this.closeAllMenus(); }); menu.appendChild(btn);\r\n    });\r\n    return menu;\r\n  }\r\n\r\n  private positionMenu(menu: HTMLElement, anchorBtn: HTMLElement) {\r\n    const rect = anchorBtn.getBoundingClientRect();\r\n    menu.style.top = (rect.top - menu.offsetHeight - 8) + 'px';\r\n    menu.style.left = (rect.left - menu.offsetWidth + rect.width) + 'px';\r\n    if (parseFloat(menu.style.top) < 0) menu.style.top = (rect.bottom + 8) + 'px';\r\n  }\r\n\r\n  private toggleMenu(key: string, btn: HTMLElement, items: { label: string; action: () => void; danger?: boolean }[]) {\r\n    if (this.openMenus[key]) { this.closeAllMenus(); return; }\r\n    this.closeAllMenus();\r\n    const m = this.buildMenu(key, items);\r\n    document.body.appendChild(m);\r\n    this.positionMenu(m, btn);\r\n    this.openMenus[key] = m;\r\n    btn.setAttribute('data-open','true');\r\n  }\r\n\r\n  // Feature modules now own theme modal & save/load dialogs.\r\n\r\n  private closeAllMenus() {\r\n    Object.values(this.openMenus).forEach(m => m.remove());\r\n    Object.keys(this.openMenus).forEach(k => delete this.openMenus[k]);\r\n    this.root.querySelectorAll('[data-open=\"true\"]').forEach(b => b.removeAttribute('data-open'));\r\n  }\r\n}\r\n", "export interface AutoCreatePopupDeps {\r\n  createBlock(kind: string, pos: {x:number;y:number}): void;\r\n  addConnection(source: string, target: string): void;\r\n  getBlocks(): Record<string, any>;\r\n}\r\n\r\nexport class AutoCreatePopup {\r\n  private deps: AutoCreatePopupDeps;\r\n  constructor(deps: AutoCreatePopupDeps) { this.deps = deps; }\r\n\r\n  show(sourceId: string, at: { x:number; y:number }) {\r\n    const kinds = [\r\n      { kind: 'process', label: 'Process' },\r\n      { kind: 'decision', label: 'Decision' },\r\n      { kind: 'io', label: 'I/O' },\r\n      { kind: 'end', label: 'End' }\r\n    ];\r\n    const popup = document.createElement('div');\r\n    popup.className = 'fc-auto-popup fade-in';\r\n    popup.innerHTML = `\r\n      <div class=\"fc-auto-header\">Create block?<button class=\"fc-close\" aria-label=\"Close\">\u2715</button></div>\r\n      <div class=\"fc-auto-body\">\r\n        <p style=\"margin:0 0 6px; font-size:12px; opacity:.8;\">Add a new block here and connect from source.</p>\r\n        <div class=\"fc-auto-list\"></div>\r\n        <div class=\"fc-auto-actions\">\r\n          <button class=\"fc-btn fc-cancel\">Cancel</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    document.body.appendChild(popup);\r\n    const list = popup.querySelector('.fc-auto-list') as HTMLElement;\r\n    kinds.forEach(k => {\r\n      const btn = document.createElement('button');\r\n      btn.className = 'fc-btn kind';\r\n      btn.textContent = k.label;\r\n      btn.addEventListener('click', () => {\r\n        const newPos = { x: at.x, y: at.y - 40 };\r\n        this.deps.createBlock(k.kind, newPos);\r\n        const blocks = this.deps.getBlocks();\r\n        let newBlockId: string | null = null;\r\n        for (const bId of Object.keys(blocks)) {\r\n          const b = blocks[bId];\r\n            if (Math.abs(b.position.x - newPos.x) < 2 && Math.abs(b.position.y - newPos.y) < 2) { newBlockId = bId; }\r\n        }\r\n        if (newBlockId) {\r\n          this.deps.addConnection(sourceId, newBlockId);\r\n        }\r\n        popup.remove();\r\n      });\r\n      list.appendChild(btn);\r\n    });\r\n    popup.querySelector('.fc-cancel')?.addEventListener('click', () => popup.remove());\r\n    popup.querySelector('.fc-close')?.addEventListener('click', () => popup.remove());\r\n  }\r\n}\r\n", "export const DEFAULT_CANVAS_WIDTH = 4000;\r\nexport const DEFAULT_CANVAS_HEIGHT = 4000;\r\n\r\nexport interface CanvasDimensionsProvider {\r\n  getCanvasWidth(): number;\r\n  getCanvasHeight(): number;\r\n}\r\n\r\nexport class StaticCanvasDimensions implements CanvasDimensionsProvider {\r\n  getCanvasWidth() { return DEFAULT_CANVAS_WIDTH; }\r\n  getCanvasHeight() { return DEFAULT_CANVAS_HEIGHT; }\r\n}\r\n\r\nexport const defaultCanvasDimensions = new StaticCanvasDimensions();\r\n", "import { AppState, Action, Connection } from './types.js';\r\nimport { DEFAULT_CANVAS_WIDTH, DEFAULT_CANVAS_HEIGHT } from './config.js';\r\n\r\nexport function reducer(state: AppState, action: Action): AppState {\r\n  switch (action.type) {\r\n    case 'ADD_BLOCK': {\r\n      return { ...state, blocks: { ...state.blocks, [action.block.id]: action.block }, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'UPDATE_BLOCK': {\r\n      const existing = state.blocks[action.id];\r\n      if (!existing) return state;\r\n      return { ...state, blocks: { ...state.blocks, [action.id]: { ...existing, ...action.patch } }, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'MOVE_BLOCK': {\r\n      const blk = state.blocks[action.id];\r\n      if (!blk) return state;\r\n      let pos = action.position;\r\n      if (state.grid?.enabled && state.grid.snap) {\r\n        const size = state.grid.size || 20;\r\n        pos = { x: Math.round(pos.x / size) * size, y: Math.round(pos.y / size) * size };\r\n      }\r\n  const CANVAS_W = DEFAULT_CANVAS_WIDTH;\r\n  const CANVAS_H = DEFAULT_CANVAS_HEIGHT;\r\n      let maxX = CANVAS_W - blk.size.width; if (maxX < 0) maxX = 0;\r\n      let maxY = CANVAS_H - blk.size.height; if (maxY < 0) maxY = 0;\r\n      if (pos.x < 0) pos = { ...pos, x: 0 }; else if (pos.x > maxX) pos = { ...pos, x: maxX };\r\n      if (pos.y < 0) pos = { ...pos, y: 0 }; else if (pos.y > maxY) pos = { ...pos, y: maxY };\r\n      if (blk.position.x === pos.x && blk.position.y === pos.y) return state; // no movement\r\n      return { ...state, blocks: { ...state.blocks, [action.id]: { ...blk, position: pos } }, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'DELETE_BLOCK': {\r\n      if (!state.blocks[action.id]) return state;\r\n      const { [action.id]: _, ...rest } = state.blocks;\r\n      const filteredConns: Record<string, Connection> = {};\r\n      Object.values(state.connections).forEach(c => { if (c.source !== action.id && c.target !== action.id) filteredConns[c.id] = c; });\r\n      const ms = state.multiSelect ? state.multiSelect.filter(id => id !== action.id) : [];\r\n      return { ...state, blocks: rest, connections: filteredConns, selection: {}, multiSelect: ms, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'ADD_CONNECTION': {\r\n      return { ...state, connections: { ...state.connections, [action.connection.id]: action.connection }, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'UPDATE_CONNECTION': {\r\n      const existing = state.connections[action.id];\r\n      if (!existing) return state;\r\n      return { ...state, connections: { ...state.connections, [action.id]: { ...existing, ...action.patch } }, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'DELETE_CONNECTION': {\r\n      const { [action.id]: __, ...rest } = state.connections;\r\n      return { ...state, connections: rest, selection: state.selection.connectionId === action.id ? {} : state.selection, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'SET_CONNECTION_STYLE': {\r\n      if (state.connectionStyle === action.style) return state;\r\n      const updatedConns: Record<string, Connection> = {};\r\n      Object.values(state.connections).forEach(c => { updatedConns[c.id] = { ...c, style: action.style }; });\r\n      return { ...state, connectionStyle: action.style, connections: updatedConns, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'START_CONNECTION_DRAFT': {\r\n      return { ...state, connectionDraft: { sourceBlock: action.sourceBlock, currentPoint: action.point } };\r\n    }\r\n    case 'UPDATE_CONNECTION_DRAFT': {\r\n      if (!state.connectionDraft) return state;\r\n      return { ...state, connectionDraft: { ...state.connectionDraft, currentPoint: action.point } };\r\n    }\r\n    case 'CANCEL_CONNECTION_DRAFT': {\r\n      const { connectionDraft, ...rest } = state;\r\n      return { ...rest } as AppState;\r\n    }\r\n    case 'SELECT_BLOCK': {\r\n      return { ...state, selection: { blockId: action.id } };\r\n    }\r\n    case 'SELECT_CONNECTION': {\r\n      return { ...state, selection: { connectionId: action.id } };\r\n    }\r\n    case 'SET_MULTI_SELECT': {\r\n      return { ...state, multiSelect: [...action.ids] };\r\n    }\r\n    case 'SET_VIEWPORT': {\r\n      return { ...state, viewport: { ...state.viewport, ...action.viewport } };\r\n    }\r\n    case 'SET_GRID': {\r\n      const current = state.grid || { enabled: false, size: 20, snap: true };\r\n      return { ...state, grid: { enabled: action.grid.enabled ?? current.enabled, size: action.grid.size ?? current.size, snap: action.grid.snap ?? current.snap } };\r\n    }\r\n    case 'INCREMENT_HISTORY': {\r\n      return { ...state, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    case 'BULK_SET_STATE': {\r\n      return { ...state, ...action.state };\r\n    }\r\n    case 'MULTIDRAG_BLOCKS': {\r\n      if (!action.changes.length) return state;\r\n      // Snap first, then compute group bounding box and adjust as one.\r\n      const CANVAS_W = DEFAULT_CANVAS_WIDTH;\r\n      const CANVAS_H = DEFAULT_CANVAS_HEIGHT;\r\n      const updated: typeof state.blocks = { ...state.blocks };\r\n      const snapped: { id:string; pos:{x:number;y:number}; size:{w:number;h:number} }[] = [];\r\n      for (const ch of action.changes) {\r\n        const blk = updated[ch.id]; if (!blk) continue;\r\n        let pos = ch.position;\r\n        if (state.grid?.enabled && state.grid.snap) {\r\n          const size = state.grid.size || 20;\r\n          pos = { x: Math.round(pos.x / size) * size, y: Math.round(pos.y / size) * size };\r\n        }\r\n        snapped.push({ id: ch.id, pos: { x: pos.x, y: pos.y }, size: { w: blk.size.width, h: blk.size.height } });\r\n      }\r\n      if (!snapped.length) return state;\r\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n      for (const s of snapped) {\r\n        if (s.pos.x < minX) minX = s.pos.x;\r\n        if (s.pos.y < minY) minY = s.pos.y;\r\n        if (s.pos.x + s.size.w > maxX) maxX = s.pos.x + s.size.w;\r\n        if (s.pos.y + s.size.h > maxY) maxY = s.pos.y + s.size.h;\r\n      }\r\n      let adjustX = 0, adjustY = 0;\r\n      if (minX < 0) adjustX = -minX; if (minY < 0) adjustY = -minY;\r\n      if (maxX + adjustX > CANVAS_W) adjustX += (CANVAS_W - (maxX + adjustX));\r\n      if (maxY + adjustY > CANVAS_H) adjustY += (CANVAS_H - (maxY + adjustY));\r\n      let changed = false;\r\n      for (const s of snapped) {\r\n        const blk = updated[s.id]; if (!blk) continue;\r\n        const nx = s.pos.x + adjustX;\r\n        const ny = s.pos.y + adjustY;\r\n        if (blk.position.x === nx && blk.position.y === ny) continue;\r\n        updated[s.id] = { ...blk, position: { x: nx, y: ny } };\r\n        changed = true;\r\n      }\r\n      if (!changed) return state;\r\n      return { ...state, blocks: updated, historyVersion: state.historyVersion + 1 };\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n", "import { initialState, Action, AppState } from './types.js';\r\nimport { reducer } from './reducer.js';\r\n\r\nexport class Store {\r\n  private state: AppState = initialState();\r\n  private listeners = new Set<() => void>();\r\n  dispatch(action: Action) { this.state = reducer(this.state, action); this.listeners.forEach(l => l()); }\r\n  getState() { return this.state; }\r\n  subscribe(fn: () => void) { this.listeners.add(fn); return () => this.listeners.delete(fn); }\r\n  replaceState(next: AppState) { this.state = next; this.listeners.forEach(l => l()); }\r\n}\r\n", "export type EventMap = {\r\n  'viewport:change': { scale: number; offset: {x:number;y:number} };\r\n  'connection:draft:start': { sourceId: string };\r\n  'connection:draft:end': { sourceId: string; canceled: boolean; targetId?: string };\r\n  'connection:added': { id: string; sourceId: string; targetId: string };\r\n  'block:drag:start': { id: string };\r\n  'block:drag:end': { id: string; position: { x:number;y:number } };\r\n};\r\n\r\ntype Handler<T> = (payload: T) => void;\r\n\r\nexport class EventBus<E extends Record<string, any>> {\r\n  private handlers: { [K in keyof E]?: Set<Handler<E[K]>> } = {};\r\n  on<K extends keyof E>(evt: K, handler: Handler<E[K]>) { (this.handlers[evt] ||= new Set()).add(handler); return () => this.off(evt, handler); }\r\n  off<K extends keyof E>(evt: K, handler: Handler<E[K]>) { this.handlers[evt]?.delete(handler); }\r\n  emit<K extends keyof E>(evt: K, payload: E[K]) { this.handlers[evt]?.forEach(h => h(payload)); }\r\n}\r\n", "import { Point, clamp } from './types.js';\r\nimport { Store } from './Store.js';\r\nimport { EventBus, EventMap } from './EventBus.js';\r\n\r\nexport class ViewportController {\r\n  private canvas: HTMLElement;\r\n  private store: Store;\r\n  private panOrigin: Point | null = null;\r\n  private isPanning = false;\r\n  private raf = false;\r\n  private bus?: EventBus<EventMap>;\r\n\r\n  constructor(canvas: HTMLElement, store: Store, bus?: EventBus<EventMap>) {\r\n    this.canvas = canvas;\r\n    this.store = store;\r\n    this.bus = bus;\r\n  }\r\n\r\n  startPan(clientX: number, clientY: number) {\r\n    this.isPanning = true; this.panOrigin = { x: clientX, y: clientY }; this.canvas.classList.add('grabbing');\r\n  }\r\n  endPan() { this.isPanning = false; this.panOrigin = null; this.canvas.classList.remove('grabbing'); }\r\n\r\n  handlePointerMove(e: PointerEvent) {\r\n    if (!this.isPanning || !this.panOrigin) return;\r\n    const st = this.store.getState();\r\n    const dx = e.clientX - this.panOrigin.x;\r\n    const dy = e.clientY - this.panOrigin.y;\r\n    this.panOrigin = { x: e.clientX, y: e.clientY };\r\n    this.store.dispatch({ type: 'SET_VIEWPORT', viewport: { offset: { x: st.viewport.offset.x + dx, y: st.viewport.offset.y + dy } } });\r\n    this.apply();\r\n  }\r\n\r\n  wheelZoom(e: WheelEvent, screenToLocal: (x:number,y:number)=>Point) {\r\n    if (!e.ctrlKey) return false;\r\n    e.preventDefault();\r\n    const st = this.store.getState();\r\n    const before = screenToLocal(e.clientX, e.clientY);\r\n    const scale = clamp(st.viewport.scale * (e.deltaY < 0 ? 1.1 : 0.9), st.viewport.bounds.minScale, st.viewport.bounds.maxScale);\r\n    this.store.dispatch({ type: 'SET_VIEWPORT', viewport: { scale } });\r\n    const after = screenToLocal(e.clientX, e.clientY);\r\n    const v = this.store.getState().viewport;\r\n    const adjust = { x: v.offset.x + (after.x - before.x)*scale, y: v.offset.y + (after.y - before.y)*scale };\r\n    this.store.dispatch({ type: 'SET_VIEWPORT', viewport: { offset: adjust } });\r\n    this.apply();\r\n    return true;\r\n  }\r\n\r\n  pinchStartDistance: number | null = null;\r\n  touchStart(e: TouchEvent) {\r\n    if (e.touches.length === 2) {\r\n      const dx = e.touches[0].clientX - e.touches[1].clientX;\r\n      const dy = e.touches[0].clientY - e.touches[1].clientY;\r\n      this.pinchStartDistance = Math.hypot(dx, dy);\r\n    }\r\n  }\r\n  touchMove(e: TouchEvent, screenToLocal: (x:number,y:number)=>Point) {\r\n    if (e.touches.length === 2 && this.pinchStartDistance) {\r\n      e.preventDefault();\r\n      const dx = e.touches[0].clientX - e.touches[1].clientX;\r\n      const dy = e.touches[0].clientY - e.touches[1].clientY;\r\n      const dist = Math.hypot(dx, dy);\r\n      const st = this.store.getState();\r\n      const scale = clamp(st.viewport.scale * (dist / this.pinchStartDistance), st.viewport.bounds.minScale, st.viewport.bounds.maxScale);\r\n      this.pinchStartDistance = dist;\r\n      this.store.dispatch({ type:'SET_VIEWPORT', viewport: { scale } });\r\n      this.apply();\r\n    }\r\n  }\r\n\r\n  apply() {\r\n    const { viewport } = this.store.getState();\r\n    this.canvas.style.transform = `translate(${viewport.offset.x}px, ${viewport.offset.y}px) scale(${viewport.scale})`;\r\n    this.bus?.emit('viewport:change', { scale: viewport.scale, offset: { x: viewport.offset.x, y: viewport.offset.y } });\r\n  }\r\n}\r\n", "import { Store } from './Store.js';\r\nimport { EventBus, EventMap } from './EventBus.js';\r\nimport { Point } from './types.js';\r\nimport { ConnectionManager } from './ConnectionManager.js';\r\n\r\nexport class ConnectionDraftController {\r\n  private store: Store;\r\n  private bus: EventBus<EventMap>;\r\n  private connectionManager: ConnectionManager;\r\n  private canvas: HTMLElement;\r\n  private draftLine: SVGPathElement | null = null;\r\n\r\n  constructor(canvas: HTMLElement, store: Store, bus: EventBus<EventMap>, connectionManager: ConnectionManager) {\r\n    this.canvas = canvas;\r\n    this.store = store;\r\n    this.bus = bus;\r\n    this.connectionManager = connectionManager;\r\n  }\r\n\r\n  startDraft(sourceBlockId: string, startPoint: Point) {\r\n    this.store.dispatch({ type: 'START_CONNECTION_DRAFT', sourceBlock: sourceBlockId, point: startPoint });\r\n    this.ensureDraftPath();\r\n    this.bus.emit('connection:draft:start', { sourceId: sourceBlockId });\r\n  }\r\n\r\n  updateDraft(currentPoint: Point) {\r\n    const st = this.store.getState();\r\n    if (!st.connectionDraft || !this.draftLine) return;\r\n    this.store.dispatch({ type: 'UPDATE_CONNECTION_DRAFT', point: currentPoint });\r\n    const refreshed = this.store.getState();\r\n    const srcBlk = refreshed.blocks[refreshed.connectionDraft!.sourceBlock];\r\n    if (!srcBlk) return;\r\n    const srcEl = document.getElementById(srcBlk.id);\r\n    const w = srcEl ? srcEl.offsetWidth : srcBlk.size.width;\r\n    const h = srcEl ? srcEl.offsetHeight : srcBlk.size.height;\r\n    const start = { x: srcBlk.position.x + w, y: srcBlk.position.y + h/2 };\r\n    const style = refreshed.connectionStyle;\r\n    if (style === 'orthogonal') {\r\n      const midX = (start.x + currentPoint.x) / 2;\r\n      this.draftLine.setAttribute('d', `M ${start.x} ${start.y} L ${midX} ${start.y} L ${midX} ${currentPoint.y} L ${currentPoint.x} ${currentPoint.y}`);\r\n    } else {\r\n      const dx = (currentPoint.x - start.x) * 0.5;\r\n      const c1x = start.x + dx;\r\n      const c2x = currentPoint.x - dx;\r\n      this.draftLine.setAttribute('d', `M ${start.x} ${start.y} C ${c1x} ${start.y}, ${c2x} ${currentPoint.y}, ${currentPoint.x} ${currentPoint.y}`);\r\n    }\r\n  }\r\n\r\n  completeDraft(targetBlockId?: string) {\r\n    const st = this.store.getState();\r\n    if (!st.connectionDraft) return;\r\n    const sourceId = st.connectionDraft.sourceBlock;\r\n    if (targetBlockId && targetBlockId !== sourceId) {\r\n      const id = this.connectionManager.addConnection(sourceId, targetBlockId);\r\n      if (id) {\r\n        // connection:added already emitted by ConnectionManager; just emit draft end\r\n        this.bus.emit('connection:draft:end', { sourceId, canceled: false, targetId: targetBlockId });\r\n      } else {\r\n        this.bus.emit('connection:draft:end', { sourceId, canceled: true });\r\n      }\r\n    } else {\r\n      this.bus.emit('connection:draft:end', { sourceId, canceled: true });\r\n    }\r\n    this.cleanup();\r\n  }\r\n\r\n  cancelDraft() {\r\n    const st = this.store.getState();\r\n    if (!st.connectionDraft) return;\r\n    const sourceId = st.connectionDraft.sourceBlock;\r\n    this.bus.emit('connection:draft:end', { sourceId, canceled: true });\r\n    this.cleanup();\r\n  }\r\n\r\n  private ensureDraftPath() {\r\n    if (!this.draftLine) {\r\n      const svg = this.connectionManager['svg'] as SVGSVGElement; // internal access\r\n      this.draftLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n      this.draftLine.setAttribute('stroke', '#4ea1ff');\r\n      this.draftLine.setAttribute('stroke-width', '2');\r\n      this.draftLine.setAttribute('fill', 'none');\r\n      svg.appendChild(this.draftLine);\r\n    }\r\n  }\r\n\r\n  private cleanup() {\r\n    this.store.dispatch({ type: 'CANCEL_CONNECTION_DRAFT' });\r\n    this.draftLine?.remove();\r\n    this.draftLine = null;\r\n  }\r\n}\r\n", "import { AppState } from './types.js';\r\nimport { Store } from './Store.js';\r\n\r\ninterface UndoSnapshotMeta { label: string; } // extendable\r\n\r\nexport class UndoManager {\r\n  private store: Store;\r\n  private undoStack: { state: AppState; meta: UndoSnapshotMeta }[] = [];\r\n  private redoStack: { state: AppState; meta: UndoSnapshotMeta }[] = [];\r\n  private opBaseline: AppState | null = null;\r\n  private opLabel = '';\r\n  constructor(store: Store) { this.store = store; }\r\n\r\n  // Operation lifecycle -----------------------------------------------------\r\n  begin(label: string) {\r\n    if (this.opBaseline) return; // already in op\r\n    this.opBaseline = structuredClone(this.store.getState());\r\n    this.opLabel = label;\r\n  }\r\n\r\n  commitIfChanged() {\r\n    if (!this.opBaseline) return;\r\n    const current = this.store.getState();\r\n    if (!this.statesEqual(this.opBaseline, current)) {\r\n      this.undoStack.push({ state: this.opBaseline, meta: { label: this.opLabel } });\r\n      this.redoStack.length = 0;\r\n      this.emitDebug();\r\n    }\r\n    this.opBaseline = null; this.opLabel='';\r\n  }\r\n\r\n  cancel() { this.opBaseline = null; this.opLabel=''; }\r\n\r\n  // Equality on structural slices only\r\n  private statesEqual(a: AppState, b: AppState) {\r\n    return JSON.stringify({blocks:a.blocks,connections:a.connections,viewport:a.viewport,grid:a.grid,style:a.connectionStyle}) ===\r\n           JSON.stringify({blocks:b.blocks,connections:b.connections,viewport:b.viewport,grid:b.grid,style:b.connectionStyle});\r\n  }\r\n\r\n  // Legacy method shims (for tests/external code not yet migrated) ---------\r\n  captureIfChanged() { /* no-op in new model */ }\r\n  forceCapture() { if (!this.opBaseline) { this.begin('legacy'); this.commitIfChanged(); } }\r\n  captureCurrent() { this.commitIfChanged(); }\r\n\r\n  // Traversal ---------------------------------------------------------------\r\n  undo() {\r\n    if (this.opBaseline) { // abort active op (treat as not committed)\r\n      this.cancel();\r\n    }\r\n    if (this.undoStack.length === 0) return false;\r\n    const snapshot = this.undoStack.pop()!;\r\n    const current = structuredClone(this.store.getState());\r\n    this.redoStack.push({ state: current, meta: { label: snapshot.meta.label } });\r\n    this.store.replaceState(structuredClone(snapshot.state));\r\n    this.emitDebug();\r\n    return true;\r\n  }\r\n\r\n  redo() {\r\n    if (this.opBaseline) { this.cancel(); }\r\n    if (this.redoStack.length === 0) return false;\r\n    const snapshot = this.redoStack.pop()!;\r\n    const current = structuredClone(this.store.getState());\r\n    this.undoStack.push({ state: current, meta: { label: snapshot.meta.label } });\r\n    this.store.replaceState(structuredClone(snapshot.state));\r\n    this.emitDebug();\r\n    return true;\r\n  }\r\n\r\n  run(label: string, fn: () => void) {\r\n    this.begin(label);\r\n    try { fn(); } finally { this.commitIfChanged(); }\r\n  }\r\n\r\n  // Debug ------------------------------------------------------------------\r\n  getDebugStacks() {\r\n    return {\r\n      undoDepth: this.undoStack.length,\r\n      redoDepth: this.redoStack.length,\r\n      opActive: !!this.opBaseline,\r\n      opLabel: this.opLabel,\r\n      lastUndoLabel: this.undoStack[this.undoStack.length-1]?.meta.label,\r\n      lastRedoLabel: this.redoStack[this.redoStack.length-1]?.meta.label\r\n    };\r\n  }\r\n  private emitDebug() { window.dispatchEvent(new CustomEvent('fc:undo:debug', { detail: this.getDebugStacks() })); }\r\n}\r\n", "export interface LayoutRefs {\r\n  root: HTMLElement;\r\n  canvas: HTMLElement;\r\n  status: HTMLElement;\r\n}\r\n\r\nexport function buildLayout(root: HTMLElement, toolbar: HTMLElement): LayoutRefs {\r\n  root.innerHTML = '';\r\n  root.appendChild(toolbar);\r\n  const workspaceWrapper = document.createElement('div');\r\n  workspaceWrapper.className='fc-workspace-wrapper';\r\n  const canvas = document.createElement('div');\r\n  canvas.className='fc-canvas';\r\n  workspaceWrapper.appendChild(canvas);\r\n  root.appendChild(workspaceWrapper);\r\n  const status = document.createElement('div');\r\n  status.className='fc-status';\r\n  status.id='fc-status';\r\n  status.textContent='Ready';\r\n  root.appendChild(status);\r\n  return { root, canvas, status };\r\n}\r\n", "import { Store } from './Store.js';\r\nimport { IGridManager } from './interfaces.js';\r\nimport { EventBus, EventMap } from './EventBus.js';\r\n\r\nexport class GridManager implements IGridManager {\r\n  private farThreshold = 0.55; // below this scale hide minor lines\r\n  private bus?: EventBus<EventMap>;\r\n  constructor(private store: Store, private canvas: HTMLElement, bus?: EventBus<EventMap>) {\r\n    this.bus = bus;\r\n    this.bus?.on('viewport:change', ({ scale }) => this.updateZoomClass(scale));\r\n  }\r\n\r\n  apply() {\r\n    const st = this.store.getState();\r\n    if (st.grid?.enabled) this.canvas.classList.add('with-grid'); else this.canvas.classList.remove('with-grid');\r\n    this.updateZoomClass(this.store.getState().viewport.scale);\r\n  }\r\n\r\n  toggle() {\r\n    const st = this.store.getState();\r\n    const enabled = !(st.grid?.enabled);\r\n    this.store.dispatch({ type: 'SET_GRID', grid: { enabled } });\r\n    this.apply();\r\n    this.persist();\r\n    return enabled;\r\n  }\r\n\r\n  restore() {\r\n    const grid = localStorage.getItem('fc-grid');\r\n    if (grid) {\r\n      try { const parsed = JSON.parse(grid); this.store.dispatch({ type:'SET_GRID', grid: parsed }); this.apply(); } catch {}\r\n    }\r\n  }\r\n\r\n  persist() {\r\n    const g = this.store.getState().grid;\r\n    try { localStorage.setItem('fc-grid', JSON.stringify({ enabled: g?.enabled, size: g?.size, snap: g?.snap })); } catch {}\r\n  }\r\n\r\n  private updateZoomClass(scale: number) {\r\n    if (!this.store.getState().grid?.enabled) { this.canvas.classList.remove('grid-zoom-far'); return; }\r\n    if (scale <= this.farThreshold) this.canvas.classList.add('grid-zoom-far'); else this.canvas.classList.remove('grid-zoom-far');\r\n  }\r\n}\r\n", "import { IThemeManager } from './interfaces.js';\r\n\r\ninterface StoredCustomTheme { name: string; vars: Record<string,string>; }\r\n\r\nconst CUSTOM_KEY = 'fc-custom-themes';\r\nconst PREVIEW_KEY = 'fc-theme-previews';\r\n\r\nexport class ThemeManager implements IThemeManager {\r\n  private customThemes: StoredCustomTheme[] = [];\r\n  private previews: Record<string, { bg:string; accent:string; text:string }> = {};\r\n\r\n  constructor() {\r\n    this.loadCustom();\r\n    this.loadPreviews();\r\n  }\r\n\r\n  restore() {\r\n    const saved = localStorage.getItem('fc-theme');\r\n    if (saved) document.documentElement.setAttribute('data-theme', saved);\r\n  }\r\n  persist(theme: string) {\r\n    try { localStorage.setItem('fc-theme', theme); } catch {}\r\n  }\r\n  set(theme: string) {\r\n    document.documentElement.setAttribute('data-theme', theme);\r\n    this.persist(theme);\r\n  }\r\n\r\n  listThemes(builtin: string[]): string[] {\r\n    return [...builtin, ...this.customThemes.map(t => t.name)];\r\n  }\r\n\r\n  getCustomTheme(name: string) { return this.customThemes.find(t => t.name === name); }\r\n\r\n  registerCustom(name: string, vars: Record<string,string>) {\r\n    // Merge or add\r\n    const existing = this.customThemes.find(t => t.name === name);\r\n    if (existing) existing.vars = vars; else this.customThemes.push({ name, vars });\r\n    this.applyCustomThemeStyle(name, vars);\r\n    this.saveCustom();\r\n    this.generatePreview(name, vars);\r\n    this.savePreviews();\r\n  }\r\n\r\n  removeCustom(name: string) {\r\n    this.customThemes = this.customThemes.filter(t => t.name !== name);\r\n    const styleEl = document.getElementById('fc-theme-custom-'+name);\r\n    if (styleEl) styleEl.remove();\r\n    this.saveCustom();\r\n    delete this.previews[name];\r\n    this.savePreviews();\r\n  }\r\n\r\n  private applyCustomThemeStyle(name: string, vars: Record<string,string>) {\r\n    let styleEl = document.getElementById('fc-theme-custom-'+name) as HTMLStyleElement | null;\r\n    if (!styleEl) {\r\n      styleEl = document.createElement('style');\r\n      styleEl.id = 'fc-theme-custom-'+name;\r\n      document.head.appendChild(styleEl);\r\n    }\r\n    const lines = Object.entries(vars)\r\n      .filter(([k])=> k.startsWith('--fc-'))\r\n      .map(([k,v])=> `  ${k}: ${v};`)\r\n      .join('\\n');\r\n    styleEl.textContent = `:root[data-theme=\"${name}\"] {\\n${lines}\\n}`;\r\n  }\r\n\r\n  private loadCustom() {\r\n    try { const raw = localStorage.getItem(CUSTOM_KEY); if (raw) { this.customThemes = JSON.parse(raw); this.customThemes.forEach(t=> this.applyCustomThemeStyle(t.name, t.vars)); } } catch {}\r\n  }\r\n  private saveCustom() { try { localStorage.setItem(CUSTOM_KEY, JSON.stringify(this.customThemes)); } catch {}\r\n  }\r\n\r\n  getPreview(name: string) { return this.previews[name]; }\r\n\r\n  ensurePreviewForBuiltin(name: string) {\r\n    if (this.previews[name]) return this.previews[name];\r\n    // Create a temp element with data-theme attr to read computed vars without switching global theme\r\n    const el = document.createElement('div');\r\n    el.setAttribute('data-theme', name);\r\n    // Clone root variable context by applying attribute temporarily to a shadow root container\r\n    // Simpler: temporarily set on html, read, then revert\r\n    const prev = document.documentElement.getAttribute('data-theme');\r\n    document.documentElement.setAttribute('data-theme', name);\r\n    const cs = getComputedStyle(document.documentElement);\r\n    const bg = cs.getPropertyValue('--fc-bg').trim() || '#ffffff';\r\n    const accent = cs.getPropertyValue('--fc-accent').trim() || '#4ea1ff';\r\n    const text = cs.getPropertyValue('--fc-text').trim() || '#222222';\r\n    if (prev) document.documentElement.setAttribute('data-theme', prev); else document.documentElement.removeAttribute('data-theme');\r\n    this.previews[name] = { bg, accent, text };\r\n    this.savePreviews();\r\n    return this.previews[name];\r\n  }\r\n\r\n  private generatePreview(name: string, vars: Record<string,string>) {\r\n    const bg = vars['--fc-bg'] || '#ffffff';\r\n    const accent = vars['--fc-accent'] || '#8888ff';\r\n    const text = vars['--fc-text'] || '#222222';\r\n    this.previews[name] = { bg, accent, text };\r\n  }\r\n  private loadPreviews() { try { const raw = localStorage.getItem(PREVIEW_KEY); if (raw) this.previews = JSON.parse(raw); } catch {}\r\n  }\r\n  private savePreviews() { try { localStorage.setItem(PREVIEW_KEY, JSON.stringify(this.previews)); } catch {}\r\n  }\r\n}\r\n", "import { Store } from './Store.js';\r\nimport { IFileIO } from './interfaces.js';\r\n\r\nexport class FileIO implements IFileIO {\r\n  constructor(private store: Store, private statusCb: (msg: string)=>void) {}\r\n\r\n  exportJSON() {\r\n    const data = JSON.stringify(this.store.getState(), null, 2);\r\n    const blob = new Blob([data], { type: 'application/json' });\r\n    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'flowchart.json'; a.click();\r\n    setTimeout(()=> URL.revokeObjectURL(a.href), 0);\r\n    this.statusCb('Exported JSON');\r\n  }\r\n\r\n  importJSON() {\r\n    const inp = document.createElement('input'); inp.type='file'; inp.accept='.json';\r\n    inp.onchange = () => {\r\n      const file = inp.files?.[0]; if (!file) return;\r\n      file.text().then(t => {\r\n        try { const parsed = JSON.parse(t); this.store.dispatch({ type:'BULK_SET_STATE', state: parsed }); this.statusCb('Imported'); }\r\n        catch { alert('Invalid JSON'); }\r\n      });\r\n    };\r\n    inp.click();\r\n  }\r\n}\r\n", "import { IHotkeysManager } from './interfaces.js';\r\n\r\nexport class HotkeysManager implements IHotkeysManager {\r\n  constructor(private undo: ()=>void, private redo: ()=>void) {}\r\n  attach() {\r\n    window.addEventListener('keydown', (e) => {\r\n      if (e.ctrlKey && !e.shiftKey && e.key.toLowerCase() === 'z') { e.preventDefault(); this.undo(); }\r\n      else if ((e.ctrlKey && e.key.toLowerCase() === 'y') || (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'z')) { e.preventDefault(); this.redo(); }\r\n    });\r\n  }\r\n}\r\n", "export class UndoDebugPanel {\r\n  private root: HTMLDivElement;\r\n  constructor() {\r\n    this.root = document.createElement('div');\r\n    this.root.className = 'fc-undo-debug';\r\n    this.root.style.cssText = [\r\n      'position:fixed','bottom:8px','right:8px','z-index:9999','font:11px/1.4 monospace',\r\n      'background:var(--fc-bg-alt,rgba(0,0,0,0.7))','color:var(--fc-text,#fff)','padding:6px 8px',\r\n      'border:1px solid var(--fc-border,#444)','border-radius:4px','max-width:220px','box-shadow:0 2px 6px rgba(0,0,0,0.4)'\r\n    ].join(';');\r\n    this.root.innerHTML = '<strong style=\"font-weight:600;\">Undo Debug</strong><div class=\"fc-ud-body\"></div><div class=\"fc-ud-actions\" style=\"margin-top:4px;display:flex;gap:4px;flex-wrap:wrap;\"></div>';\r\n    const actions = this.root.querySelector('.fc-ud-actions') as HTMLDivElement;\r\n    const btnDump = document.createElement('button'); btnDump.textContent='Dump'; btnDump.style.cssText='flex:1;cursor:pointer;padding:2px 4px;font-size:11px;';\r\n    btnDump.addEventListener('click', ()=> {\r\n      const detail = (window as any).flowchartApp?.undoManager?.getDebugStacks?.();\r\n      console.log('[UndoDebug dump]', detail);\r\n    });\r\n    const btnForce = document.createElement('button'); btnForce.textContent='ForceCap'; btnForce.style.cssText='flex:1;cursor:pointer;padding:2px 4px;font-size:11px;';\r\n    btnForce.addEventListener('click', ()=> {\r\n      (window as any).flowchartApp?.undoManager?.forceCapture?.();\r\n    });\r\n    const btnClear = document.createElement('button'); btnClear.textContent='Clear'; btnClear.style.cssText='flex:1;cursor:pointer;padding:2px 4px;font-size:11px;';\r\n    btnClear.addEventListener('click', ()=> {\r\n      const um = (window as any).flowchartApp?.undoManager; if (!um) return;\r\n      // Not providing a public clear; only for dev: reassign internal arrays\r\n      if (confirm('Clear undo/redo stacks?')) {\r\n        um['undoStack'] = []; um['redoStack'] = []; um['lastVersion'] = (window as any).flowchartApp?.store?.getState().historyVersion || 0;\r\n        window.dispatchEvent(new CustomEvent('fc:undo:debug', { detail: um.getDebugStacks() }));\r\n      }\r\n    });\r\n    actions.append(btnDump, btnForce, btnClear);\r\n    document.body.appendChild(this.root);\r\n    window.addEventListener('fc:undo:debug', (e: any)=> this.render(e.detail));\r\n    // initial state\r\n    setTimeout(()=> {\r\n      const um = (window as any).flowchartApp?.undoManager; if (um) this.render(um.getDebugStacks());\r\n    }, 50);\r\n  }\r\n  private render(detail: any) {\r\n    const body = this.root.querySelector('.fc-ud-body'); if (!body) return;\r\n    body.innerHTML = `\r\n      <div>undoDepth: ${detail.undoDepth}</div>\r\n      <div>redoDepth: ${detail.redoDepth}</div>\r\n      <div>lastVersion: ${detail.lastVersion}</div>\r\n      <div>topUndo: ${detail.topUndo ?? '-'}</div>\r\n      <div>topRedo: ${detail.topRedo ?? '-'}</div>\r\n    `;\r\n  }\r\n}\r\n", "import { Store } from './Store.js';\r\nimport { AppState, Block } from './types.js';\r\nimport { DEFAULT_CANVAS_WIDTH, DEFAULT_CANVAS_HEIGHT } from './config.js';\r\n\r\ninterface MinimapDeps {\r\n  store: Store;\r\n  applyViewport(): void;\r\n}\r\n\r\nexport class MinimapManager {\r\n  private deps: MinimapDeps;\r\n  private root: HTMLElement;\r\n  private canvas: HTMLCanvasElement;\r\n  private ctx: CanvasRenderingContext2D;\r\n  private width = 200;\r\n  private height = 200;\r\n  private scaleX = this.width / DEFAULT_CANVAS_WIDTH;\r\n  private scaleY = this.height / DEFAULT_CANVAS_HEIGHT;\r\n  private draggingView = false;\r\n  private dragOffset: { dx:number; dy:number } | null = null;\r\n  private rafPending = false;\r\n\r\n  constructor(container: HTMLElement, deps: MinimapDeps) {\r\n    this.deps = deps;\r\n    this.root = document.createElement('div');\r\n    this.root.className = 'fc-minimap';\r\n  this.root.style.position = 'fixed';\r\n  // Positioned bottom-left per latest requirement\r\n  this.root.style.left = '12px';\r\n  this.root.style.bottom = '12px';\r\n    this.root.style.width = this.width+'px';\r\n    this.root.style.height = this.height+'px';\r\n    this.root.style.border = '1px solid var(--fc-border-strong)';\r\n    this.root.style.background = 'rgba(0,0,0,0.35)';\r\n    this.root.style.backdropFilter = 'blur(2px)';\r\n    this.root.style.cursor = 'pointer';\r\n    this.root.style.borderRadius = '4px';\r\n    this.root.style.zIndex = '2000';\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.width = this.width; this.canvas.height = this.height;\r\n    this.canvas.style.width = '100%';\r\n    this.canvas.style.height = '100%';\r\n    this.root.appendChild(this.canvas);\r\n    container.appendChild(this.root);\r\n    const ctx = this.canvas.getContext('2d');\r\n    // In test environment (jsdom) context may be null; create shim\r\n    this.ctx = (ctx || {\r\n      clearRect() {}, fillRect() {}, strokeRect() {}, beginPath() {}, moveTo() {}, lineTo() {}, stroke() {},\r\n      fillStyle: '', strokeStyle: '', lineWidth: 1\r\n    }) as any;\r\n    this.attachEvents();\r\n    this.render();\r\n  }\r\n\r\n  private attachEvents() {\r\n    this.canvas.addEventListener('mousedown', (e) => {\r\n      const vpRect = this.viewportRect();\r\n      const mx = e.offsetX; const my = e.offsetY;\r\n      if (mx >= vpRect.x && my >= vpRect.y && mx <= vpRect.x + vpRect.w && my <= vpRect.y + vpRect.h) {\r\n        // drag viewport\r\n        this.draggingView = true;\r\n        this.dragOffset = { dx: mx - vpRect.x, dy: my - vpRect.y };\r\n      } else {\r\n        this.centerMainAt(mx, my);\r\n      }\r\n    });\r\n    window.addEventListener('mousemove', (e) => {\r\n      if (!this.draggingView) return;\r\n      const rect = this.canvas.getBoundingClientRect();\r\n      const mx = e.clientX - rect.left; const my = e.clientY - rect.top;\r\n      const newX = mx - (this.dragOffset?.dx||0);\r\n      const newY = my - (this.dragOffset?.dy||0);\r\n      this.panViewportToRectOrigin(newX, newY);\r\n    });\r\n    window.addEventListener('mouseup', () => { this.draggingView = false; this.dragOffset = null; });\r\n  }\r\n\r\n  private state(): AppState { return this.deps.store.getState(); }\r\n\r\n  private viewportRect() {\r\n    const st = this.state();\r\n    // Main viewport visible size in logical coords approximated using canvas element size (root canvas size is DOM size of flow area)\r\n    const rootEl = (document.querySelector('.fc-canvas') as HTMLElement) || { clientWidth: 1200, clientHeight: 800 } as any;\r\n    const logicalW = rootEl.clientWidth / st.viewport.scale;\r\n    const logicalH = rootEl.clientHeight / st.viewport.scale;\r\n    // Offset is top-left in logical space\r\n    const vx = st.viewport.offset.x * this.scaleX;\r\n    const vy = st.viewport.offset.y * this.scaleY;\r\n    const vw = logicalW * this.scaleX;\r\n    const vh = logicalH * this.scaleY;\r\n    return { x: vx, y: vy, w: vw, h: vh };\r\n  }\r\n\r\n  private centerMainAt(mx: number, my: number) {\r\n    const st = this.state();\r\n    const rootEl = (document.querySelector('.fc-canvas') as HTMLElement) || { clientWidth: 1200, clientHeight: 800 } as any;\r\n    const logicalW = rootEl.clientWidth / st.viewport.scale;\r\n    const logicalH = rootEl.clientHeight / st.viewport.scale;\r\n    const targetLogicalX = mx / this.scaleX - logicalW / 2;\r\n    const targetLogicalY = my / this.scaleY - logicalH / 2;\r\n    this.deps.store.dispatch({ type:'SET_VIEWPORT', viewport: { offset: { x: targetLogicalX, y: targetLogicalY } } });\r\n    this.deps.applyViewport();\r\n    this.requestRender();\r\n  }\r\n\r\n  private panViewportToRectOrigin(miniX: number, miniY: number) {\r\n    const st = this.state();\r\n    const rootEl = (document.querySelector('.fc-canvas') as HTMLElement) || { clientWidth: 1200, clientHeight: 800 } as any;\r\n    const logicalW = rootEl.clientWidth / st.viewport.scale;\r\n    const logicalH = rootEl.clientHeight / st.viewport.scale;\r\n    const targetLogicalX = miniX / this.scaleX;\r\n    const targetLogicalY = miniY / this.scaleY;\r\n    this.deps.store.dispatch({ type:'SET_VIEWPORT', viewport: { offset: { x: targetLogicalX, y: targetLogicalY } } });\r\n    this.deps.applyViewport();\r\n    this.requestRender();\r\n  }\r\n\r\n  private requestRender() {\r\n    if (this.rafPending) return; this.rafPending = true; requestAnimationFrame(()=> { this.rafPending = false; this.render(); });\r\n  }\r\n\r\n  public render() {\r\n    const st = this.state();\r\n    this.ctx.clearRect(0,0,this.width,this.height);\r\n    // Background grid representation (faint)\r\n    this.ctx.fillStyle = 'rgba(255,255,255,0.05)';\r\n    this.ctx.fillRect(0,0,this.width,this.height);\r\n    // Blocks\r\n    this.ctx.lineWidth = 1;\r\n    for (const blk of Object.values(st.blocks) as Block[]) {\r\n      const x = blk.position.x * this.scaleX;\r\n      const y = blk.position.y * this.scaleY;\r\n      const w = blk.size.width * this.scaleX;\r\n      const h = blk.size.height * this.scaleY;\r\n      this.ctx.fillStyle = blk.id === st.selection.blockId ? 'rgba(80,160,255,0.9)' : 'rgba(255,255,255,0.7)';\r\n      this.ctx.fillRect(x, y, Math.max(2,w), Math.max(2,h));\r\n      this.ctx.strokeStyle = 'rgba(0,0,0,0.4)';\r\n      this.ctx.strokeRect(x+0.5, y+0.5, Math.max(2,w)-1, Math.max(2,h)-1);\r\n    }\r\n    // Viewport rectangle\r\n    const vp = this.viewportRect();\r\n    this.ctx.strokeStyle = 'rgba(255,200,0,0.9)';\r\n    this.ctx.lineWidth = 2;\r\n    this.ctx.strokeRect(vp.x+0.5, vp.y+0.5, vp.w, vp.h);\r\n  }\r\n\r\n  public notifyStateChange(prev: AppState, next: AppState) {\r\n    if (prev.blocks !== next.blocks || prev.viewport !== next.viewport || prev.selection !== next.selection) {\r\n      this.requestRender();\r\n    }\r\n  }\r\n\r\n  public setVisible(on: boolean) { this.root.style.display = on ? 'block' : 'none'; }\r\n  public isVisible() { return this.root.style.display !== 'none'; }\r\n  public getElement() { return this.root; }\r\n}\r\n\r\n// Pure utilities (testable without DOM/canvas)\r\nexport function computeMinimapScale(miniWidth: number, miniHeight: number, canvasW = DEFAULT_CANVAS_WIDTH, canvasH = DEFAULT_CANVAS_HEIGHT) {\r\n  return { scaleX: miniWidth / canvasW, scaleY: miniHeight / canvasH };\r\n}\r\n\r\nexport function mapBlockToMinimap(block: Block, scaleX: number, scaleY: number) {\r\n  return {\r\n    x: block.position.x * scaleX,\r\n    y: block.position.y * scaleY,\r\n    w: Math.max(2, block.size.width * scaleX),\r\n    h: Math.max(2, block.size.height * scaleY)\r\n  };\r\n}\r\n", "import { initialState, Action, BlockKind, Point } from '../types.js';\r\nimport { BlockManager } from '../BlockManager.js';\r\nimport { ConnectionManager } from '../ConnectionManager.js';\r\nimport { Toolbar } from '../Toolbar.js';\r\nimport { AutoCreatePopup } from '../AutoCreatePopup.js';\r\nimport { Store } from '../Store.js';\r\nimport { EventBus, EventMap } from '../EventBus.js';\r\nimport { ViewportController } from '../ViewportController.js';\r\nimport { ConnectionDraftController } from '../ConnectionDraftController.js';\r\nimport { UndoManager } from '../UndoManager.js';\r\nimport { buildLayout } from '../layout.js';\r\nimport { GridManager } from '../GridManager.js';\r\nimport { ThemeManager } from '../ThemeManager.js';\r\nimport { FileIO } from '../FileIO.js';\r\nimport { HotkeysManager } from '../HotkeysManager.js';\r\nimport { UndoDebugPanel } from '../UndoDebugPanel.js';\r\nimport { AppDependencies, IGridManager, IThemeManager, IFileIO, IHotkeysManager } from '../interfaces.js';\r\nimport { MinimapManager } from '../MinimapManager.js';\r\n\r\nexport class FlowchartApp {\r\n  private store = new Store();\r\n  private root: HTMLElement;\r\n  private canvas!: HTMLElement;\r\n  private blockManager!: BlockManager;\r\n  private connectionManager!: ConnectionManager;\r\n  private draftController!: ConnectionDraftController;\r\n  private viewportController!: ViewportController;\r\n  private bus = new EventBus<EventMap>();\r\n  private undoManager = new UndoManager(this.store);\r\n  private viewportEl!: HTMLElement;\r\n  private rafPointer = false;\r\n  private contentBounds: { minX:number; minY:number; maxX:number; maxY:number } = { minX:0, minY:0, maxX:0, maxY:0 };\r\n  private dragMoveActive = false;\r\n  private marqueeEl: HTMLElement | null = null;\r\n  private marqueeStart: Point | null = null;\r\n  private marqueeActive = false;\r\n  private minimap?: MinimapManager;\r\n  private minimapEnabled: boolean = true;\r\n  private themeManager!: IThemeManager;\r\n  private gridManager!: IGridManager;\r\n  private fileIO!: IFileIO;\r\n  private hotkeys?: IHotkeysManager;\r\n\r\n  constructor(root: HTMLElement, deps?: Partial<AppDependencies>) {\r\n    this.root = root;\r\n    try {\r\n      const raw = localStorage.getItem('fc-minimap-enabled');\r\n      if (raw === '0') this.minimapEnabled = false; else if (raw === '1') this.minimapEnabled = true;\r\n      localStorage.setItem('fc-minimap-enabled', this.minimapEnabled ? '1' : '0');\r\n    } catch {}\r\n    const toolbarContainer = document.createElement('div');\r\n    const layout = buildLayout(root, toolbarContainer);\r\n    this.canvas = layout.canvas;\r\n    this.viewportEl = layout.canvas;\r\n    this.blockManager = new BlockManager(this.canvas, { dispatch: (a)=>this.store.dispatch(a), getState: ()=> this.store.getState(), bus: this.bus });\r\n    this.connectionManager = new ConnectionManager(this.canvas, { dispatch: (a)=>this.store.dispatch(a), getState: ()=> this.store.getState(), bus: this.bus });\r\n    this.draftController = new ConnectionDraftController(this.canvas, this.store, this.bus, this.connectionManager);\r\n    this.viewportController = new ViewportController(this.canvas, this.store, this.bus);\r\n    this.enhanceDispatch();\r\n    this.attachGlobalEvents();\r\n    this.themeManager = deps?.themeManager || new ThemeManager();\r\n    this.themeManager.restore();\r\n    this.gridManager = deps?.gridManager || new GridManager(this.store, this.canvas, this.bus);\r\n    this.gridManager.restore();\r\n    this.fileIO = deps?.fileIO || new FileIO(this.store, (m)=> this.updateStatus(m));\r\n    new Toolbar(toolbarContainer, {\r\n      createBlock: (k,pos)=> (this.undoManager as any).run('add-block', ()=> this.blockManager.createBlock(k,pos)),\r\n      setConnectionStyle: (style)=> (this.undoManager as any).run('set-conn-style', ()=> { this.store.dispatch({ type:'SET_CONNECTION_STYLE', style }); this.connectionManager.renderAll(); }),\r\n      exportJSON: ()=> this.fileIO.exportJSON(),\r\n      importJSON: ()=> (this.undoManager as any).run('import-json', ()=> this.fileIO.importJSON()),\r\n      clearAll: ()=> (this.undoManager as any).run('clear-all', ()=> { this.store.dispatch({ type:'BULK_SET_STATE', state: initialState() }); this.blockManager.renderAll(); this.connectionManager.renderAll(); }),\r\n      setTheme: (theme)=> { this.themeManager.set(theme); },\r\n      resetView: ()=> (this.undoManager as any).run('reset-view', ()=> { this.store.dispatch({ type: 'SET_VIEWPORT', viewport: { scale:1, offset:{x:0,y:0} } }); this.applyViewport(); }),\r\n      randomPosition: ()=> this.randomPosition(),\r\n      updateStatus: (m)=> this.updateStatus(m),\r\n      undo: ()=> this.undo(),\r\n      redo: ()=> this.redo(),\r\n      toggleGrid: ()=> (this.undoManager as any).run('toggle-grid', ()=> { const on = this.gridManager.toggle(); this.updateStatus('Grid '+(on?'on':'off')); }),\r\n      gridEnabled: ()=> !!this.store.getState().grid?.enabled,\r\n      arrange: (kind: string)=> this.runArrange(kind),\r\n      toggleMinimap: ()=> this.toggleMinimap(),\r\n      minimapEnabled: ()=> this.minimapEnabled\r\n    });\r\n    this.render();\r\n    this.minimap = new MinimapManager(this.root, { store: this.store, applyViewport: ()=> this.applyViewport() });\r\n    this.minimap.setVisible(this.minimapEnabled);\r\n    (this as any).themeManager = this.themeManager;\r\n    if ((this.undoManager as any).forceCapture) { (this.undoManager as any).forceCapture(); }\r\n  }\r\n\r\n  private enhanceDispatch() {\r\n    const original = this.store.dispatch.bind(this.store);\r\n    this.store.dispatch = ((action: Action) => {\r\n      const isMove = action.type === 'MOVE_BLOCK' || action.type === 'MULTIDRAG_BLOCKS';\r\n      if (isMove) {\r\n        if (!this.dragMoveActive) { (this.undoManager as any).begin?.('move-block'); this.dragMoveActive = true; }\r\n        original(action);\r\n      } else {\r\n        original(action);\r\n        (this.undoManager as any).commitIfChanged?.();\r\n        this.dragMoveActive = false;\r\n      }\r\n      const after = this.store.getState();\r\n      this.minimap?.notifyStateChange((this as any)._prevState || after, after);\r\n      (this as any)._prevState = after;\r\n      switch(action.type) {\r\n        case 'MOVE_BLOCK':\r\n          this.connectionManager.updateConnectionsForBlock(action.id);\r\n          const blk = after.blocks[action.id];\r\n          const el = document.getElementById(action.id);\r\n          if (blk && el) { el.style.left = blk.position.x + 'px'; el.style.top = blk.position.y + 'px'; }\r\n          break;\r\n        case 'MULTIDRAG_BLOCKS':\r\n          for (const ch of action.changes) {\r\n            this.connectionManager.updateConnectionsForBlock(ch.id);\r\n            const blk2 = after.blocks[ch.id];\r\n            const el2 = document.getElementById(ch.id);\r\n            if (blk2 && el2) { el2.style.left = blk2.position.x + 'px'; el2.style.top = blk2.position.y + 'px'; }\r\n          }\r\n          break;\r\n        case 'UPDATE_BLOCK':\r\n          if (action.patch?.size || action.patch?.position) this.connectionManager.updateConnectionsForBlock(action.id);\r\n          break;\r\n        case 'ADD_CONNECTION':\r\n        case 'DELETE_CONNECTION':\r\n        case 'SET_CONNECTION_STYLE':\r\n          this.connectionManager.renderAll();\r\n          break;\r\n        case 'ADD_BLOCK':\r\n        case 'DELETE_BLOCK':\r\n          this.connectionManager.renderAll();\r\n          if (action.type === 'DELETE_BLOCK') { const el3 = document.getElementById(action.id); if (el3) el3.remove(); }\r\n          break;\r\n      }\r\n      this.updateStatus(`Blocks: ${Object.keys(after.blocks).length} Conns: ${Object.keys(after.connections).length} Zoom: ${(after.viewport.scale*100).toFixed(0)}%`);\r\n    }) as any;\r\n\r\n    this.bus.on('block:drag:end', () => {\r\n      if (this.dragMoveActive) { (this.undoManager as any).commitIfChanged?.(); }\r\n      this.dragMoveActive = false;\r\n    });\r\n  }\r\n\r\n  private toggleMinimap() {\r\n    this.minimapEnabled = !this.minimapEnabled;\r\n    if (this.minimap) this.minimap.setVisible(this.minimapEnabled);\r\n    try { localStorage.setItem('fc-minimap-enabled', this.minimapEnabled ? '1' : '0'); } catch {}\r\n    this.updateStatus('Minimap ' + (this.minimapEnabled ? 'on' : 'off'));\r\n  }\r\n\r\n  private randomPosition(): Point { return { x: 80 + Math.random()*400, y: 80 + Math.random()*300 }; }\r\n\r\n  private attachGlobalEvents() {\r\n    this.canvas.addEventListener('pointerdown', (e) => {\r\n      const anchor = (e.target as HTMLElement).closest('.fc-anchor');\r\n      if (anchor) {\r\n        const blockEl = (anchor.parentElement as HTMLElement);\r\n        const id = blockEl.id;\r\n        const blk = this.store.getState().blocks[id];\r\n        if (blk) {\r\n          const w = blockEl.offsetWidth;\r\n          const h = blockEl.offsetHeight;\r\n          const startPoint = { x: blk.position.x + w, y: blk.position.y + h/2 };\r\n          this.draftController.startDraft(id, startPoint);\r\n        }\r\n        e.stopPropagation();\r\n      } else if (e.target === this.canvas) {\r\n        if (e.shiftKey) {\r\n          const pt = this.screenToLocal(e.clientX, e.clientY);\r\n          this.startMarquee(pt);\r\n        } else {\r\n          this.viewportController.startPan(e.clientX, e.clientY);\r\n        }\r\n      }\r\n    });\r\n    window.addEventListener('pointermove', (e) => {\r\n      if (!this.rafPointer) { this.rafPointer = true; requestAnimationFrame(()=>{ this.rafPointer=false; this.onPointerMove(e); }); }\r\n    });\r\n    window.addEventListener('pointerup', (e) => this.onPointerUp(e));\r\n    this.canvas.addEventListener('wheel', (e) => this.onWheel(e), { passive: false });\r\n    this.canvas.addEventListener('touchmove', (e) => this.onTouchMove(e), { passive:false });\r\n    this.canvas.addEventListener('touchstart', (e)=> this.onTouchStart(e), { passive:false });\r\n    window.addEventListener('keydown', (e) => {\r\n      if ((e.key === 'Delete' || e.key === 'Backspace') && !(e.target instanceof HTMLInputElement) && !(e.target instanceof HTMLTextAreaElement) && !(e.target as HTMLElement).isContentEditable) {\r\n        const st = this.store.getState();\r\n        if (st.multiSelect && st.multiSelect.length > 1) { e.preventDefault(); this.handleMultiDelete(); }\r\n      }\r\n      if ((e.key === 'a' || e.key === 'A') && (e.ctrlKey || e.metaKey)) {\r\n        const target = e.target as HTMLElement;\r\n        if (target && (target.isContentEditable || target.tagName === 'INPUT' || target.tagName === 'TEXTAREA')) return;\r\n        const blocks = this.store.getState().blocks;\r\n        const ids = Object.keys(blocks);\r\n        if (ids.length) { e.preventDefault(); this.store.dispatch({ type: 'SET_MULTI_SELECT', ids }); this.store.dispatch({ type: 'SELECT_BLOCK', id: ids[0] }); this.applySelectionHighlight(ids); }\r\n      }\r\n    });\r\n  }\r\n\r\n  private onPointerMove(e: PointerEvent) {\r\n    this.viewportController.handlePointerMove(e);\r\n    const st = this.store.getState();\r\n    if (this.marqueeActive && this.marqueeStart) { const cur = this.screenToLocal(e.clientX, e.clientY); this.updateMarquee(cur); }\r\n    if (st.connectionDraft) { const pt = this.pointerToLocal(e); this.draftController.updateDraft(pt); }\r\n  }\r\n\r\n  private onPointerUp(e: PointerEvent) {\r\n    this.viewportController.endPan();\r\n    const st = this.store.getState();\r\n    if (this.marqueeActive) { this.finishMarquee(); }\r\n    if (st.connectionDraft) {\r\n      const targetBlock = (e.target as HTMLElement).closest('.fc-block');\r\n      if (targetBlock && targetBlock.id !== st.connectionDraft.sourceBlock) { this.draftController.completeDraft(targetBlock.id); }\r\n      else if (!targetBlock) { const dropPoint = this.pointerToLocal(e); this.showCreateBlockPopup(st.connectionDraft.sourceBlock, dropPoint); }\r\n      else { this.draftController.cancelDraft(); }\r\n    }\r\n  }\r\n\r\n  private popup = new AutoCreatePopup({\r\n    createBlock: (k,pos)=> this.blockManager.createBlock(k as any, pos),\r\n    addConnection: (s,t)=> this.connectionManager.addConnection(s,t),\r\n    getBlocks: ()=> this.store.getState().blocks\r\n  });\r\n\r\n  private showCreateBlockPopup(sourceId: string, at: { x: number; y: number }) { this.draftController.cancelDraft(); this.popup.show(sourceId, at); }\r\n  private onWheel(e: WheelEvent) { this.viewportController.wheelZoom(e, (x,y)=> this.screenToLocal(x,y)); }\r\n  private onTouchStart(e: TouchEvent) { this.viewportController.touchStart(e); }\r\n  private onTouchMove(e: TouchEvent) { this.viewportController.touchMove(e, (x,y)=> this.screenToLocal(x,y)); }\r\n  private applyViewport() { this.viewportController.apply(); }\r\n  private pointerToLocal(e: PointerEvent): Point { return this.screenToLocal(e.clientX, e.clientY); }\r\n  private screenToLocal(clientX: number, clientY: number): Point { const rect = this.canvas.getBoundingClientRect(); const st = this.store.getState(); return { x: (clientX - rect.left) / st.viewport.scale, y: (clientY - rect.top) / st.viewport.scale }; }\r\n\r\n  private updateStatus(msg: string) {\r\n    const el = document.getElementById('fc-status'); if (!el) return; try { const st = this.store.getState(); const count = st.multiSelect ? st.multiSelect.length : (st.selection.blockId ? 1 : 0); if (count > 0) { el.textContent = msg + ' Selected: ' + count; } else { el.textContent = msg; } } catch { el.textContent = msg; }\r\n  }\r\n\r\n  private runArrange(kind: string) {\r\n    const st = this.store.getState();\r\n    const ids = st.multiSelect && st.multiSelect.length ? st.multiSelect : (st.selection.blockId ? [st.selection.blockId] : []);\r\n    if (ids.length < 2) { this.updateStatus('Arrange requires \u22652 blocks'); return; }\r\n    const blocks = ids.map(id => st.blocks[id]).filter(Boolean);\r\n    if (blocks.length < 2) return;\r\n    const changes: { id:string; position:{x:number;y:number} }[] = [];\r\n    const xs = blocks.map(b=>b.position.x);\r\n    const ys = blocks.map(b=>b.position.y);\r\n    const left = Math.min(...xs);\r\n    const right = Math.max(...blocks.map(b=> b.position.x + b.size.width));\r\n    const top = Math.min(...ys);\r\n    const bottom = Math.max(...blocks.map(b=> b.position.y + b.size.height));\r\n    const centerX = (left + right) / 2;\r\n    const middleY = (top + bottom) / 2;\r\n    const byId: Record<string, any> = {}; blocks.forEach(b=> byId[b.id]=b);\r\n    const applyPosition = (id: string, x:number, y:number) => { const b = byId[id]; if (!b) return; if (b.position.x !== x || b.position.y !== y) changes.push({ id, position:{x,y} }); };\r\n    if (kind.startsWith('align-')) {\r\n      for (const b of blocks) {\r\n        switch(kind) {\r\n          case 'align-left': applyPosition(b.id, left, b.position.y); break;\r\n          case 'align-right': applyPosition(b.id, right - b.size.width, b.position.y); break;\r\n          case 'align-center': applyPosition(b.id, Math.round(centerX - b.size.width/2), b.position.y); break;\r\n          case 'align-top': applyPosition(b.id, b.position.x, top); break;\r\n          case 'align-bottom': applyPosition(b.id, b.position.x, bottom - b.size.height); break;\r\n          case 'align-middle': applyPosition(b.id, b.position.x, Math.round(middleY - b.size.height/2)); break;\r\n        }\r\n      }\r\n    } else if (kind === 'dist-h' || kind === 'dist-v') {\r\n      if (kind === 'dist-h') {\r\n        const ordered = [...blocks].sort((a,b)=> a.position.x - b.position.x);\r\n        const first = ordered[0]; const last = ordered[ordered.length-1];\r\n        const spanTotal = (last.position.x + last.size.width) - first.position.x;\r\n        if (ordered.length > 2 && spanTotal > 0) {\r\n          const totalWidths = ordered.reduce((s,b)=> s + b.size.width, 0);\r\n          const gaps = ordered.length - 1;\r\n          const freeSpace = spanTotal - totalWidths;\r\n          const gapSize = freeSpace / gaps;\r\n          let cursor = first.position.x + first.size.width + gapSize;\r\n          for (let i=1;i<ordered.length-1;i++) { const b = ordered[i]; applyPosition(b.id, Math.round(cursor), b.position.y); cursor += b.size.width + gapSize; }\r\n        }\r\n      } else {\r\n        const ordered = [...blocks].sort((a,b)=> a.position.y - b.position.y);\r\n        const first = ordered[0]; const last = ordered[ordered.length-1];\r\n        const spanTotal = (last.position.y + last.size.height) - first.position.y;\r\n        if (ordered.length > 2 && spanTotal > 0) {\r\n          const totalHeights = ordered.reduce((s,b)=> s + b.size.height, 0);\r\n          const gaps = ordered.length - 1;\r\n          const freeSpace = spanTotal - totalHeights;\r\n          const gapSize = freeSpace / gaps;\r\n          let cursor = first.position.y + first.size.height + gapSize;\r\n          for (let i=1;i<ordered.length-1;i++) { const b = ordered[i]; applyPosition(b.id, b.position.x, Math.round(cursor)); cursor += b.size.height + gapSize; }\r\n        }\r\n      }\r\n    }\r\n    if (!changes.length) { this.updateStatus('Arrange: no changes'); return; }\r\n    const existingMap: Record<string, {x:number;y:number}> = {}; blocks.forEach(b=> existingMap[b.id] = { x: b.position.x, y: b.position.y });\r\n    const changedSet = new Set(changes.map(c=>c.id));\r\n    const fullChanges = ids.map(id => changedSet.has(id) ? changes.find(c=>c.id===id)! : { id, position: { ...existingMap[id] } });\r\n    (this.undoManager as any).run('arrange-blocks', () => { if (fullChanges.length === 1) { this.store.dispatch({ type:'MOVE_BLOCK', id: fullChanges[0].id, position: fullChanges[0].position }); } else { this.store.dispatch({ type:'MULTIDRAG_BLOCKS', changes: fullChanges }); } });\r\n    this.applySelectionHighlight(ids);\r\n  }\r\n\r\n  private startMarquee(start: Point) { this.cancelMarquee(); this.marqueeStart = start; this.marqueeActive = true; this.marqueeEl = document.createElement('div'); this.marqueeEl.className = 'fc-marquee'; this.canvas.appendChild(this.marqueeEl); }\r\n  private updateMarquee(current: Point) { if (!this.marqueeEl || !this.marqueeStart) return; const x1 = Math.min(this.marqueeStart.x, current.x); const y1 = Math.min(this.marqueeStart.y, current.y); const x2 = Math.max(this.marqueeStart.x, current.x); const y2 = Math.max(this.marqueeStart.y, current.y); this.marqueeEl.style.left = x1 + 'px'; this.marqueeEl.style.top = y1 + 'px'; this.marqueeEl.style.width = (x2 - x1) + 'px'; this.marqueeEl.style.height = (y2 - y1) + 'px'; const st = this.store.getState(); const ids: string[] = []; for (const blk of Object.values(st.blocks)) { const bx1 = blk.position.x; const by1 = blk.position.y; const bx2 = bx1 + blk.size.width; const by2 = by1 + blk.size.height; if (bx1 >= x1 && by1 >= y1 && bx2 <= x2 && by2 <= y2) ids.push(blk.id); } this.store.dispatch({ type: 'SET_MULTI_SELECT', ids }); this.store.dispatch({ type: 'SELECT_BLOCK', id: ids[0] }); this.applySelectionHighlight(ids); }\r\n  private finishMarquee() { this.marqueeActive = false; this.marqueeStart = null; if (this.marqueeEl) { this.marqueeEl.remove(); this.marqueeEl = null; } }\r\n  private cancelMarquee() { if (this.marqueeEl) { this.marqueeEl.remove(); } this.marqueeEl = null; this.marqueeActive = false; this.marqueeStart = null; }\r\n  private applySelectionHighlight(ids: string[]) { this.canvas.querySelectorAll('.fc-block').forEach(el => el.classList.remove('selected')); ids.forEach(id => document.getElementById(id)?.classList.add('selected')); }\r\n  private handleMultiDelete() { const st = this.store.getState(); const ids: string[] = st.multiSelect && st.multiSelect.length ? [...st.multiSelect] : []; if (!ids.length) return; (this.undoManager as any).run('delete-block', () => { for (const id of ids) { this.store.dispatch({ type: 'DELETE_BLOCK', id }); } const fragRemovals: HTMLElement[] = []; ids.forEach(id => { const el = document.getElementById(id); if (el) fragRemovals.push(el); }); if (fragRemovals.length) { fragRemovals.forEach(el => el.remove()); } }); }\r\n\r\n  private render() { this.applyGridOverlay(); }\r\n  private applyGridOverlay() { this.gridManager.apply(); }\r\n  undo() { if (this.store.getState().connectionDraft) { this.draftController.cancelDraft(); } if (this.undoManager.undo()) { this.afterHistoryChange(); } }\r\n  redo() { if (this.store.getState().connectionDraft) { this.draftController.cancelDraft(); } if (this.undoManager.redo()) { this.afterHistoryChange(); } }\r\n  toggleGrid() { const on = this.gridManager.toggle(); this.updateStatus('Grid '+(on?'on':'off')); }\r\n  private afterHistoryChange() { this.blockManager.renderAll(); this.connectionManager.renderAll(); this.applyViewport(); this.applyGridOverlay(); const st = this.store.getState(); this.updateStatus(`Blocks: ${Object.keys(st.blocks).length} Conns: ${Object.keys(st.connections).length} Zoom: ${(st.viewport.scale*100).toFixed(0)}%`); }\r\n  public undoBegin(label: string) { (this.undoManager as any).begin(label); }\r\n  public undoCommit() { (this.undoManager as any).commitIfChanged(); }\r\n  public undoCancel() { (this.undoManager as any).cancel(); }\r\n  private attachHotkeys() { this.hotkeys = new HotkeysManager(()=> this.undo(), ()=> this.redo()); this.hotkeys.attach(); }\r\n}\r\n\r\nexport function bootstrap() {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const root = document.getElementById('app');\r\n    if (!root) return;\r\n    const app = new FlowchartApp(root);\r\n    (app as any)['attachHotkeys']?.();\r\n    (window as any).flowchartApp = app;\r\n    if (new URLSearchParams(location.search).get('undoDebug') === '1') { new UndoDebugPanel(); }\r\n  });\r\n}\r\n", "export { FlowchartApp, bootstrap } from './core/FlowchartApp.js';\r\nimport { bootstrap } from './core/FlowchartApp.js';\r\nbootstrap();\r\n\r\n"],
  "mappings": "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",
  "names": ["_a", "_b", "_c", "original", "_a", "_a", "_b"]
}
